<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<title>A job which inputs or outputs data by accessing a database</title>
<link rel="stylesheet" href="./theme/css/readthedocs.css">
<link rel="stylesheet" href="./theme/css/font-awesome.min.css">
<link rel="stylesheet" href="./theme/css/coderay-asciidoctor.css">
<link rel="stylesheet" href="./theme/css/header-footer.css">
<title>TERASOLUNA Batch Framework for Java (5.x) Development Guideline</title>

<div class="common-bg">
  <div class="information">
    TERASOLUNA Batch Framework for Java (5.x) Development Guideline - version 5.0.1.RELEASE, 2017-9-27
  </div>
  <div class="index">
    <a href="index.html">&gt; INDEX</a>
  </div>
</div>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8VC2LCPQFM"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());  gtag('config', 'G-8VC2LCPQFM');
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-46550814-2', 'auto');
  ga('send', 'pageview');
</script>
</head>
<body id="Ch09_DBAccessJob" class="book toc2 toc-left">
<div id="header">
<h1>A job which inputs or outputs data by accessing a database</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#Ch09_DBAccessJob_Overview">Overview</a>
<ul class="sectlevel2">
<li><a href="#Ch09_DBAccessJob_Overview_Background">Background</a></li>
<li><a href="#Ch09_DBAccessJob_Overview_ProcessOverview">Process overview</a></li>
<li><a href="#Ch09_DBAccessJob_Overview_BusinessSpecification">Business specifications</a></li>
<li><a href="#Ch09_DBAccessJob_Overview_TableSpecification">Table specifications</a></li>
<li><a href="#Ch09_DBAccessJob_Overview_JobOverview">Job overview</a></li>
</ul>
</li>
<li><a href="#Ch09_DBAccessJob_Chunk">Implementation in chunk model</a>
<ul class="sectlevel2">
<li><a href="#Ch09_DBAccessJob_Chunk_JobDefinition">Creating job Bean definition file</a></li>
<li><a href="#Ch09_DBAccessJob_Chunk_Dto">Implementation of DTO</a></li>
<li><a href="#Ch09_DBAccessJob_Chunk_MyBatis">Defining database access by using MyBatis</a>
<ul class="sectlevel3">
<li><a href="#Ch09_DBAccessJob_Chunk_MyBatis_Repository">Implementation of Repository interface</a></li>
<li><a href="#Ch09_DBAccessJob_Chunk_MyBatis_MapperXML">Creating MapperXML file</a></li>
<li><a href="#Ch09_DBAccessJob_Chunk_MyBatis_Bean">Configuring Job Bean definition file</a></li>
</ul>
</li>
<li><a href="#Ch09_DBAccessJob_Chunk_Logic">Implementation of logic</a>
<ul class="sectlevel3">
<li><a href="#Ch09_DBAccessJob_Chunk_Logic_ItemProcessor">Implementation of PointAddItemProcessor class</a></li>
<li><a href="#Ch09_DBAccessJob_Chunk_Logic_Bean">Configuring job Bean definition file</a></li>
</ul>
</li>
<li><a href="#Ch09_DBAccessJob_Chunk_Execution">Job execution and results verification</a>
<ul class="sectlevel3">
<li><a href="#Ch09_DBAccessJob_Chunk_Execution_Run">Execute job from execution configuration</a></li>
<li><a href="#Ch09_DBAccessJob_Chunk_Execution_Console">Verifying console log</a></li>
<li><a href="#Ch09_DBAccessJob_Chunk_Execution_Exitcode">Verifying exit code</a></li>
<li><a href="#Ch09_DBAccessJob_Chunk_Execution_Table">Verifying member information table</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#Ch09_DBAccessJob_Tasklet">Implementation in tasklet model</a>
<ul class="sectlevel2">
<li><a href="#Ch09_DBAccessJob_Tasklet_JobDefinition">Creating job Bean definition file</a></li>
<li><a href="#Ch09_DBAccessJob_Tasklet_Dto">Implementation of DTO</a></li>
<li><a href="#Ch09_DBAccessJob_Tasklet_MyBatis">Defining database access by using MyBatis</a>
<ul class="sectlevel3">
<li><a href="#Ch09_DBAccessJob_Tasklet_MyBatis_Repository">Implementation of Repository interface</a></li>
<li><a href="#Ch09_DBAccessJob_Tasklet_MyBatis_MapperXML">Creating MapperXML file</a></li>
<li><a href="#Ch09_DBAccessJob_Tasklet_MyBatis_Bean">Setting job Bean definition file</a></li>
</ul>
</li>
<li><a href="#Ch09_DBAccessJob_Tasklet_Logic">Implementation of logic</a>
<ul class="sectlevel3">
<li><a href="#Ch09_DBAccessJob_Tasklet_Logic_Tasklet">Implementation of PointAddTasklet class</a></li>
<li><a href="#Ch09_DBAccessJob_Tasklet_Logic_Bean">Configuring job Bean definition file</a></li>
</ul>
</li>
<li><a href="#Ch09_DBAccessJob_Tasklet_Execution">Verifying execution of job and results</a>
<ul class="sectlevel3">
<li><a href="#Ch09_DBAccessJob_Tasklet_Execution_Run">Execute job from execution configuration</a></li>
<li><a href="#Ch09_DBAccessJob_Tasklet_Execution_Console">Verifying console log</a></li>
<li><a href="#Ch09_DBAccessJob_Tasklet_Execution_Exitcode">Verifying exit codes</a></li>
<li><a href="#Ch09_DBAccessJob_Tasklet_Execution_Table">Verifying member information table</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="Ch09_DBAccessJob_Overview"><a class="anchor" href="#Ch09_DBAccessJob_Overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Create a job which accesses a database.</p>
</div>
<div class="paragraph">
<p>Note that, since this chapter is explained based on TERASOLUNA Batch 5.x Development guideline,
refer <a href="Ch05_DBAccess.html#Ch05_DBAccess">database access</a> for details.</p>
</div>
<div class="paragraph">
<p>Background, process overview and business specifications of <a href="Ch09_TutorialApplication.html#Ch09_TutorialApplication">Explanation of application to be created</a>
are listed below.</p>
</div>
<div class="sect2">
<h3 id="Ch09_DBAccessJob_Overview_Background"><a class="anchor" href="#Ch09_DBAccessJob_Overview_Background"></a>Background</h3>
<div class="paragraph">
<p>Some mass retail stores issue point cards to the members. <br>
Membership types include "Gold members", "Normal members" and the services are provided based on membership type.<br>
As a part of the service, 100 points are added for "gold members" and 10 points are added for "normal members" at the end of the month,
for the members who have purchased a product during that month.</p>
</div>
</div>
<div class="sect2">
<h3 id="Ch09_DBAccessJob_Overview_ProcessOverview"><a class="anchor" href="#Ch09_DBAccessJob_Overview_ProcessOverview"></a>Process overview</h3>
<div class="paragraph">
<p>TERASOLUNA Batch 5.x will be using an application as a monthly batch process which adds
points based on membership type.</p>
</div>
</div>
<div class="sect2">
<h3 id="Ch09_DBAccessJob_Overview_BusinessSpecification"><a class="anchor" href="#Ch09_DBAccessJob_Overview_BusinessSpecification"></a>Business specifications</h3>
<div class="paragraph">
<p>Business specifications are as shown below.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When the product purchasing flag is "1"(process target), points are added based on membership type</p>
<div class="ulist">
<ul>
<li>
<p>Add 100 points when membership type is "G"(gold member), and add 10 points when membership type is "N" (Normal member)</p>
</li>
</ul>
</div>
</li>
<li>
<p>* Product purchasing flag is updated to "0" (initial status) after adding points</p>
</li>
<li>
<p>Upper limit of points is 1,000,000 points</p>
</li>
<li>
<p>If the points exceed 1,000,000 points after adding points, they are adjusted to 1,000,000 points</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Ch09_DBAccessJob_Overview_TableSpecification"><a class="anchor" href="#Ch09_DBAccessJob_Overview_TableSpecification"></a>Table specifications</h3>
<div class="paragraph">
<p>Specifications of member information table acting as an input and output resource are as shown below.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Member information table (member_info)</caption>
<colgroup>
<col style="width: 3.0927%;">
<col style="width: 15.4639%;">
<col style="width: 10.3092%;">
<col style="width: 4.1237%;">
<col style="width: 12.3711%;">
<col style="width: 8.2474%;">
<col style="width: 46.392%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">No</th>
<th class="tableblock halign-left valign-top">Attribute name</th>
<th class="tableblock halign-left valign-top">Column name</th>
<th class="tableblock halign-left valign-top">PK</th>
<th class="tableblock halign-left valign-top">Data type</th>
<th class="tableblock halign-left valign-top">Number of digits</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Member ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CHAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates a fixed 8 digit number which uniquely identifies a member.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Membership type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CHAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Membership type is as shown below.<br>
"G"(Gold member), "N"(Normal member)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Product purchasing flag</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CHAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates whether you have purchased a product in the month.<br>
When the product is purchased, it is updated to "1"(process target) and to "0"(initial status) during monthly batch processing.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Point</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">point</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates points retained by the member.<br>
Initial value is 0.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Regarding table specifications</div>
<div class="paragraph">
<p>Note that table design is not done in accordance with the actual implementation
considering the convenience of implementing this tutorial.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="Ch09_DBAccessJob_Overview_JobOverview"><a class="anchor" href="#Ch09_DBAccessJob_Overview_JobOverview"></a>Job overview</h3>
<div class="paragraph">
<p>Process flow and process sequence are shown below in order to understand
the overview of job which accesses database created here.</p>
</div>
<div class="paragraph">
<p>Process sequence covers the scope of transaction control.
Transaction control for a job uses a system containing Spring Batch which is explained by defining it as a framework transaction.
For details of transaction control, refer <a href="Ch05_Transaction.html#Ch05_Transaction">Transaction control</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Process flow overview</dt>
<dd>
<p>Overview of process flow is shown below.</p>
</dd>
</dl>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/ch09/DBAccess/Ch09_DBAccessJob_ProcessFlow.png" alt="ProcessFlow of DBAccess Job">
</div>
<div class="title">Process flow of database access job</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Process sequence in case of a chunk model</dt>
<dd>
<p>Process sequence in case of a chunk model is explained.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Orange object indicates a class to be implemented now.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/Ch09_DBAccessJob_ProcessSequence_ChunkModel.png" alt="ProcessSequence of DBAccess Job by ChunkModel">
</div>
<div class="title">Sequence diagram of chunk model</div>
</div>
<div class="olist arabic">
<div class="title">Explanation of sequence diagram</div>
<ol class="arabic">
<li>
<p>Step is executed from the job.</p>
</li>
<li>
<p>Step opens a resource.</p>
</li>
<li>
<p><code>MyBatisCursorItemReader</code> fetches all the member information from member_info table (issue select statement).</p>
<div class="ulist">
<ul>
<li>
<p>Repeat subsequent processes until input data is exhausted.</p>
</li>
<li>
<p>Start a framework transaction in chunk units.</p>
</li>
<li>
<p>Repeat the process from 4 to 10 until a chunk size is reached.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Step fetches 1 record of input data from <code>MyBatisCursorItemReader</code>.</p>
</li>
<li>
<p><code>MyBatisCursorItemReader</code> fetches 1 record of input data from member_info table.</p>
</li>
<li>
<p>member_info table returns input data to <code>MyBatisCursorItemReader</code>.</p>
</li>
<li>
<p><code>MyBatisCursorItemReader</code> returns input data to step.</p>
</li>
<li>
<p>Step performs a process for input data by <code>PointAddItemProcessor</code>.</p>
</li>
<li>
<p><code>PointAddItemProcessor</code> reads input data and adds points.</p>
</li>
<li>
<p><code>PointAddItemProcessor</code> returns process results to the step.</p>
</li>
<li>
<p>Step outputs chunk size data by <code>MyBatisBatchItemWriter</code>.</p>
</li>
<li>
<p><code>MyBatisBatchItemWriter</code> updates member information (issue update statement) for member_info table.</p>
</li>
<li>
<p>Step commits framework transaction.</p>
</li>
<li>
<p>Step returns exit code (Here, normal termination:0) to the job.</p>
</li>
</ol>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Process sequence in case of a tasklet model</dt>
<dd>
<p>Process sequence in case of a tasklet model is explained.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In this tutorial, a method which is used in chunk model is adopted for tasklet model as well wherein data for a certain number of fixed records are processed together in a batch.
This method enables efficient processing of a large amount of data. For details, refer <a href="Ch03_CreateTaskletJob.html#Ch03_CreateTaskletJob_HowToUse_Implements_InOut">Tasklet implementation which use components of chunk model</a>.</p>
</div>
<div class="paragraph">
<p>Orange coloured object indicates a class to be implemented now.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/Ch09_DBAccessJob_ProcessSequence_TaskletModel.png" alt="ProcessSequence of DBAccess Job by TaskletModel">
</div>
<div class="title">Sequence diagram of tasklet model</div>
</div>
<div class="olist arabic">
<div class="title">Explanation of sequence diagram</div>
<ol class="arabic">
<li>
<p>Step is executed from job.</p>
<div class="ulist">
<ul>
<li>
<p>Step starts a framework transaction.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Step executes <code>PointAddTasklet</code>.</p>
</li>
<li>
<p><code>PointAddTasklet</code> opens a resource.</p>
</li>
<li>
<p><code>MyBatisCursorItemReader</code> fetches all the member information from member_info table (issue select statement).</p>
<div class="ulist">
<ul>
<li>
<p>Repeat processes from 5 to 9 until input data is exhausted.</p>
</li>
<li>
<p>Repeat processes from 5 to 11 until a certain number of records is reached.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>PointAddTasklet</code> fetches 1 record of input data from <code>MyBatisCursorItemReader</code>.</p>
</li>
<li>
<p><code>MyBatisCursorItemReader</code> fetches 1 record of input data from member_info table.</p>
</li>
<li>
<p>member_info table returns input data to <code>MyBatisCursorItemReader</code>.</p>
</li>
<li>
<p><code>MyBatisCursorItemReader</code> returns input data to tasklet.</p>
</li>
<li>
<p><code>PointAddTasklet</code> reads input data and adds points.</p>
</li>
<li>
<p><code>PointAddTasklet</code> outputs data of certain records by <code>MyBatisBatchItemWriter</code>.</p>
</li>
<li>
<p><code>MyBatisBatchItemWriter</code> updates member information (issue update statement) from member_info table.</p>
</li>
<li>
<p><code>PointAddTasklet</code> returns process termination to step.</p>
</li>
<li>
<p>Step commits a framework transaction.</p>
</li>
<li>
<p>Step returns an exit code (here, successful termination: 0) to the job.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>How to implement in chunk model and tasklet model is subsequently explained.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#Ch09_DBAccessJob_Chunk">Implementation in chunk model</a></p>
</li>
<li>
<p><a href="#Ch09_DBAccessJob_Tasklet">Implementation in tasklet model</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Ch09_DBAccessJob_Chunk"><a class="anchor" href="#Ch09_DBAccessJob_Chunk"></a>Implementation in chunk model</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Processes from creation to execution for the job which accesses database in chunk model are shown with the following procedures.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#Ch09_DBAccessJob_Chunk_JobDefinition">Creating job Bean definition file</a></p>
</li>
<li>
<p><a href="#Ch09_DBAccessJob_Chunk_Dto">Implementation of DTO</a></p>
</li>
<li>
<p><a href="#Ch09_DBAccessJob_Chunk_MyBatis">Defining database access by using MyBatis</a></p>
</li>
<li>
<p><a href="#Ch09_DBAccessJob_Chunk_Logic">Implementation of logic</a></p>
</li>
<li>
<p><a href="#Ch09_DBAccessJob_Chunk_Execution">Job execution and results verification</a></p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="Ch09_DBAccessJob_Chunk_JobDefinition"><a class="anchor" href="#Ch09_DBAccessJob_Chunk_JobDefinition"></a>Creating job Bean definition file</h3>
<div class="paragraph">
<p>How to combine the elements which configure the job which accesses database in the chunk model is set in Bean definition file.<br>
Frame and common settings of Bean definition file alone are described here and each configuration element is set in subsequent sections.</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/META-INF/jobs/dbaccess/jobPointAddChunk.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/context</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:batch</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/batch</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:p</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/p</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:mybatis</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://mybatis.org/schema/mybatis-spring</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span>
             <span class="content">http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd</span>
             <span class="content">http://www.springframework.org/schema/batch http://www.springframework.org/schema/batch/spring-batch.xsd</span>
             <span class="content">http://mybatis.org/schema/mybatis-spring http://mybatis.org/schema/mybatis-spring.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="comment">&lt;!-- (1) --&gt;</span>
    <span class="tag">&lt;import</span> <span class="attribute-name">resource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:META-INF/spring/job-base-context.xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="comment">&lt;!-- (2) --&gt;</span>
    <span class="tag">&lt;context:annotation-config</span><span class="tag">/&gt;</span>

    <span class="comment">&lt;!-- (3) --&gt;</span>
    <span class="tag">&lt;context:component-scan</span> <span class="attribute-name">base-package</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.terasoluna.batch.tutorial.dbaccess.chunk</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Explanation</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Sr. No.</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Always import settings to read required Bean definitions while using TERASOLUNA Batch 5.x.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable Bean definition by using an annotation.
Use it with (3) while implementing ItemProcessor and Listener.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(3)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure component scanning.<br>
Specify a package containing component to be used (implementation class of ItemProcessor etc.), in <code>base-package</code> attribute.<br>
Use it with (2) while defining a Bean by using an annotation.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="Ch09_DBAccessJob_Chunk_Dto"><a class="anchor" href="#Ch09_DBAccessJob_Chunk_Dto"></a>Implementation of DTO</h3>
<div class="paragraph">
<p>Implement a DTO class as a class to retain business data.<br>
Create a DTO class for each table.</p>
</div>
<div class="paragraph">
<p>Since it is used as common in chunk model / tasklet model, it can be skipped if created already.</p>
</div>
<div class="listingblock">
<div class="title">org.terasoluna.batch.tutorial.common.dto.MemberInfoDTO</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.terasoluna.batch.tutorial.common.dto</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">MemberInfoDto</span> {
    <span class="directive">private</span> <span class="predefined-type">String</span> id; <span class="comment">// (1)</span>

    <span class="directive">private</span> <span class="predefined-type">String</span> type; <span class="comment">// (2)</span>

    <span class="directive">private</span> <span class="predefined-type">String</span> status; <span class="comment">// (3)</span>

    <span class="directive">private</span> <span class="type">int</span> point; <span class="comment">// (4)</span>

    <span class="directive">public</span> <span class="predefined-type">String</span> getId() {
        <span class="keyword">return</span> id;
    }

    <span class="directive">public</span> <span class="type">void</span> setId(<span class="predefined-type">String</span> id) {
        <span class="local-variable">this</span>.id = id;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getType() {
        <span class="keyword">return</span> type;
    }

    <span class="directive">public</span> <span class="type">void</span> setType(<span class="predefined-type">String</span> type) {
        <span class="local-variable">this</span>.type = type;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getStatus() {
        <span class="keyword">return</span> status;
    }

    <span class="directive">public</span> <span class="type">void</span> setStatus(<span class="predefined-type">String</span> status) {
        <span class="local-variable">this</span>.status = status;
    }

    <span class="directive">public</span> <span class="type">int</span> getPoint() {
        <span class="keyword">return</span> point;
    }

    <span class="directive">public</span> <span class="type">void</span> setPoint(<span class="type">int</span> point) {
        <span class="local-variable">this</span>.point = point;
    }
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Explanation</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Sr. No.</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define <code>id</code> as a field corresponding to member Id.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define <code>type</code> as a field corresponding to membership type.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(3)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define <code>status</code> as a field corresponding to product purchasing flag.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(4)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define <code>point</code> as a field corresponding to points.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="Ch09_DBAccessJob_Chunk_MyBatis"><a class="anchor" href="#Ch09_DBAccessJob_Chunk_MyBatis"></a>Defining database access by using MyBatis</h3>
<div class="paragraph">
<p>Implementation and setting for database access using MyBatis.</p>
</div>
<div class="paragraph">
<p>Implement following processes.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#Ch09_DBAccessJob_Chunk_MyBatis_Repository">Implementation of Repository interface</a></p>
</li>
<li>
<p><a href="#Ch09_DBAccessJob_Chunk_MyBatis_MapperXML">Creating MapperXML file</a></p>
</li>
<li>
<p><a href="#Ch09_DBAccessJob_Chunk_MyBatis_Bean">Configuring Job Bean definition file</a></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Since it is used as common in chunk model / tasklet model, it can be skipped if created already.</p>
</div>
<div class="sect3">
<h4 id="Ch09_DBAccessJob_Chunk_MyBatis_Repository"><a class="anchor" href="#Ch09_DBAccessJob_Chunk_MyBatis_Repository"></a>Implementation of Repository interface</h4>
<div class="paragraph">
<p>Implement an interface to call SQL which is defined in MapperXML.<br>
Since the implementation class for the interface is automatically generated by MyBatis, the developers are required to create only the interface.</p>
</div>
<div class="listingblock">
<div class="title">org.terasoluna.batch.tutorial.common.repository.MemberInfoRepository</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.terasoluna.batch.tutorial.common.repository</span>;

<span class="keyword">import</span> <span class="include">org.terasoluna.batch.tutorial.common.dto.MemberInfoDto</span>;
<span class="keyword">import</span> <span class="include">java.util.List</span>;

<span class="directive">public</span> <span class="type">interface</span> <span class="class">MemberInfoRepository</span> {
  <span class="predefined-type">List</span>&lt;MemberInfoDto&gt; findAll(); <span class="comment">// (1)</span>

  <span class="type">int</span> updatePointAndStatus(MemberInfoDto memberInfo); <span class="comment">// (2)</span>
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Explanation</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Sr. No.</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define a method corresponding to ID of SQL defined in MapperXML file.<br>
Here, define a method to fetch all the records from member_info table.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Here, define a method to update point and status column of member_info table.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Ch09_DBAccessJob_Chunk_MyBatis_MapperXML"><a class="anchor" href="#Ch09_DBAccessJob_Chunk_MyBatis_MapperXML"></a>Creating MapperXML file</h4>
<div class="paragraph">
<p>Create a MapperXML file which describes settings of SQL and O/R mapping.<br>
MapperXML file is created for each Repository interface.</p>
</div>
<div class="paragraph">
<p>It is possible to read MapperXML file automatically by storing it in a directory which is in conformance with rules defined by MyBatis.
Store Mapper file in the directory at the level same as package level of Repository interface to enable reading MapperXML file automatically.</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/org/terasoluna/batch/tutorial/common/repository/MemberInfoRepository.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="doctype">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;
        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>

<span class="comment">&lt;!-- (1) --&gt;</span>
<span class="tag">&lt;mapper</span> <span class="attribute-name">namespace</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.terasoluna.batch.tutorial.common.repository.MemberInfoRepository</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="comment">&lt;!-- (2) --&gt;</span>
    <span class="tag">&lt;select</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">findAll</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">resultType</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.terasoluna.batch.tutorial.common.dto.MemberInfoDto</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        SELECT
            id,
            type,
            status,
            point
        FROM
            member_info
        ORDER BY
            id ASC
    <span class="tag">&lt;/select&gt;</span>

    <span class="comment">&lt;!-- (3) --&gt;</span>
    <span class="tag">&lt;update</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">updatePointAndStatus</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">parameterType</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.terasoluna.batch.tutorial.common.dto.MemberInfoDto</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        UPDATE
            member_info
        SET
            status = #{status},
            point = #{point}
        WHERE
            id = #{id}
    <span class="tag">&lt;/update&gt;</span>
<span class="tag">&lt;/mapper&gt;</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Explanation</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Sr. No.</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify a fully qualified class name (FQCN) of Repository interface, in namespace attribute of mapper element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set SQL of reference system.<br>
Here, set a SQL which fetches all the records from member_info table.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(3)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set a SQL for update.<br>
Here, set a SQL to update status and points for the records that
match with id specified in member_info table.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Ch09_DBAccessJob_Chunk_MyBatis_Bean"><a class="anchor" href="#Ch09_DBAccessJob_Chunk_MyBatis_Bean"></a>Configuring Job Bean definition file</h4>
<div class="paragraph">
<p>Add following (1) to (3) to job Bean definition file as a setting to access the database by using MyBatis.</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/META-INF/jobs/dbaccess/jobPointAddChunk.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/context</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:batch</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/batch</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:p</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/p</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:mybatis</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://mybatis.org/schema/mybatis-spring</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span>
             <span class="content">http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd</span>
             <span class="content">http://www.springframework.org/schema/batch http://www.springframework.org/schema/batch/spring-batch.xsd</span>
             <span class="content">http://mybatis.org/schema/mybatis-spring http://mybatis.org/schema/mybatis-spring.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;import</span> <span class="attribute-name">resource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:META-INF/spring/job-base-context.xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;context:annotation-config</span><span class="tag">/&gt;</span>

    <span class="tag">&lt;context:component-scan</span> <span class="attribute-name">base-package</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.terasoluna.batch.tutorial.dbaccess.chunk</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="comment">&lt;!-- (1) --&gt;</span>
    <span class="tag">&lt;mybatis:scan</span> <span class="attribute-name">base-package</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.terasoluna.batch.tutorial.common.repository</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">factory-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobSqlSessionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="comment">&lt;!-- (2) --&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">reader</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.mybatis.spring.batch.MyBatisCursorItemReader</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">p:queryId</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.terasoluna.batch.tutorial.common.repository.MemberInfoRepository.findAll</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">p:sqlSessionFactory-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobSqlSessionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="comment">&lt;!-- (3) --&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">writer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.mybatis.spring.batch.MyBatisBatchItemWriter</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">p:statementId</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.terasoluna.batch.tutorial.common.repository.MemberInfoRepository.updatePointAndStatus</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">p:sqlSessionTemplate-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">batchModeSqlSessionTemplate</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Explanation</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Sr. No.</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure to scan Repository interface.<br>
Specify a base package which stores Repository interface, in <code>base-package</code> attribute.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure ItemReader.<br>
Specify <code>org.mybatis.spring.batch.MyBatisCursorItemReader</code> provided by MyBatis-Spring - a Spring linkage library offered by MyBatis, in <code>class</code> attribute.
Use <code>MyBatisCursorItemReader</code> to fetch a large amount of data from the database.
For details, refer <a href="Ch05_DBAccess.html#Ch05_DBAccess_HowToUse_Input">Database access in ItemReader</a>.<br>
Specify <code>namespace</code>+<code>id</code> for SQL set in MapperXML file, in <code>queryId</code> attribute.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(3)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure ItemWriter.<br>
Specify <code>org.mybatis.spring.batch.MyBatisBatchItemWriter</code> provided by MyBatis-Spring - a Spring linkage library offered by MyBatis, in <code>class</code> attribute.<br>
Specify <code>namespace</code>+<code>id</code> for SQL set in MapperXML file, in <code>queryId</code> attribute.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Accessing database other than ItemReader / ItemWriter</div>
<div class="paragraph">
<p>A method which uses Mapper interface is adopted as a method to access database other than ItemReader or ItemWriter.
Since restrictions are set as TERASOLUNA Batch 5.x while using Mapper interface,
<a href="Ch05_DBAccess.html#Ch05_DBAccess_HowToUse_Processor">Accessing database other than ItemReader/ItemWriter</a> should be referred.
For ItemProcessor implementation, refer <a href="Ch05_DBAccess.html#Ch05_DBAccess_HowToUse_Output_MyBatisMapperInterface_ItemProcess">Database access in ItemProcessor</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Ch09_DBAccessJob_Chunk_Logic"><a class="anchor" href="#Ch09_DBAccessJob_Chunk_Logic"></a>Implementation of logic</h3>
<div class="paragraph">
<p>Implement a business logic class to add points.</p>
</div>
<div class="paragraph">
<p>Implement following processes.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#Ch09_DBAccessJob_Chunk_Logic_ItemProcessor">Implementation of PointAddItemProcessor class</a></p>
</li>
<li>
<p><a href="#Ch09_DBAccessJob_Chunk_Logic_Bean">Configuring job Bean definition file</a></p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="Ch09_DBAccessJob_Chunk_Logic_ItemProcessor"><a class="anchor" href="#Ch09_DBAccessJob_Chunk_Logic_ItemProcessor"></a>Implementation of PointAddItemProcessor class</h4>
<div class="paragraph">
<p>Implement PointAddItemProcessor class which implements ItemProcessor interface.</p>
</div>
<div class="listingblock">
<div class="title">org.terasoluna.batch.tutorial.dbaccess.chunk.PointAddItemProcessor</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.terasoluna.batch.tutorial.dbaccess.chunk</span>;

<span class="keyword">import</span> <span class="include">org.springframework.batch.item.ItemProcessor</span>;
<span class="keyword">import</span> <span class="include">org.springframework.stereotype.Component</span>;
<span class="keyword">import</span> <span class="include">org.terasoluna.batch.tutorial.common.dto.MemberInfoDto</span>;

<span class="annotation">@Component</span> <span class="comment">// (1)</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">PointAddItemProcessor</span> <span class="directive">implements</span> ItemProcessor&lt;MemberInfoDto, MemberInfoDto&gt; { <span class="comment">// (2)</span>

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> TARGET_STATUS = <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>; <span class="comment">// (3)</span>

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> INITIAL_STATUS = <span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>; <span class="comment">// (4)</span>

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> GOLD_MEMBER = <span class="string"><span class="delimiter">&quot;</span><span class="content">G</span><span class="delimiter">&quot;</span></span>; <span class="comment">// (5)</span>

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> NORMAL_MEMBER = <span class="string"><span class="delimiter">&quot;</span><span class="content">N</span><span class="delimiter">&quot;</span></span>; <span class="comment">// (6)</span>

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">int</span> MAX_POINT = <span class="integer">1000000</span>; <span class="comment">// (7)</span>

    <span class="annotation">@Override</span>
    <span class="directive">public</span> MemberInfoDto process(MemberInfoDto item) <span class="directive">throws</span> <span class="exception">Exception</span> { <span class="comment">// (8) (9) (10)</span>
        <span class="keyword">if</span> (TARGET_STATUS.equals(item.getStatus())) {
            <span class="keyword">if</span> (GOLD_MEMBER.equals(item.getType())) {
                item.setPoint(item.getPoint() + <span class="integer">100</span>);
            } <span class="keyword">else</span> <span class="keyword">if</span> (NORMAL_MEMBER.equals(item.getType())) {
                item.setPoint(item.getPoint() + <span class="integer">10</span>);
            }

            <span class="keyword">if</span> (item.getPoint() &gt; MAX_POINT) {
                item.setPoint(MAX_POINT);
            }

            item.setStatus(INITIAL_STATUS);
        }

        <span class="keyword">return</span> item;
    }
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Explanation</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Sr. No.</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define a Bean by assigning <code>@Component</code> annotation to subject it to component scanning.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement <code>ItemProcessor</code> interface which specifies type of objects used in input and output, in respective generics.<br>
Here, specify <code>MemberInfoDTO</code> created in <a href="#Ch09_DBAccessJob_Chunk_Dto">Implementation of DTO</a> along with objects used in input and output.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(3)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define product purchasing flag: 1 for point addition, as a constant.<br>
Originally, such a field constant is defined as a constant class and it is very rarely defined in logic.
It should be noted that it is defined as a constant for the sake of convenience of this tutorial. (Applicable to subsequent constants as well)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(4)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define initial value of product purchasing flag:0, as a constant.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(5)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define membership type: G (gold member), as a constant.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(6)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define membership type: N (normal member), as a constant.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(7)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define upper limit of points: 1000000, as a constant.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(8)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define product purchasing flag, and business logic for adding points corresponding to membership type.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(9)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MemberInfoDTO</code> - a type of output object specified by generics of <code>ItemProcessor</code> interface
implemented by the class is the type used for return value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(10)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MemberInfoDTO</code> - a type of input object specified by generics of <code>ItemProcessor</code> interface
implemented by the class is the type used for <code>item</code> which is received as an argument.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Ch09_DBAccessJob_Chunk_Logic_Bean"><a class="anchor" href="#Ch09_DBAccessJob_Chunk_Logic_Bean"></a>Configuring job Bean definition file</h4>
<div class="paragraph">
<p>Add following (1) and subsequent objects to job Bean definition file in order to configure created business logic as a job.</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/META-INF/jobs/dbaccess/jobPointAddChunk.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/context</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:batch</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/batch</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:p</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/p</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:mybatis</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://mybatis.org/schema/mybatis-spring</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span>
             <span class="content">http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd</span>
             <span class="content">http://www.springframework.org/schema/batch http://www.springframework.org/schema/batch/spring-batch.xsd</span>
             <span class="content">http://mybatis.org/schema/mybatis-spring http://mybatis.org/schema/mybatis-spring.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;import</span> <span class="attribute-name">resource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:META-INF/spring/job-base-context.xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;context:annotation-config</span><span class="tag">/&gt;</span>

    <span class="tag">&lt;context:component-scan</span> <span class="attribute-name">base-package</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.terasoluna.batch.tutorial.dbaccess.chunk</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;mybatis:scan</span> <span class="attribute-name">base-package</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.terasoluna.batch.tutorial.common.repository</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">factory-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobSqlSessionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">reader</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.mybatis.spring.batch.MyBatisCursorItemReader</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">p:queryId</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.terasoluna.batch.tutorial.common.repository.MemberInfoRepository.findAll</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">p:sqlSessionFactory-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobSqlSessionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">writer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.mybatis.spring.batch.MyBatisBatchItemWriter</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">p:statementId</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.terasoluna.batch.tutorial.common.repository.MemberInfoRepository.updatePointAndStatus</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">p:sqlSessionTemplate-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">batchModeSqlSessionTemplate</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="comment">&lt;!-- (1) --&gt;</span>
    <span class="tag">&lt;batch:job</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobPointAddChunk</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">job-repository</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobRepository</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;batch:step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobPointAddChunk.step01</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> <span class="comment">&lt;!-- (2) --&gt;</span>
            <span class="tag">&lt;batch:tasklet</span> <span class="attribute-name">transaction-manager</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobTransactionManager</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;batch:chunk</span> <span class="attribute-name">reader</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">reader</span><span class="delimiter">&quot;</span></span>
                             <span class="attribute-name">processor</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pointAddItemProcessor</span><span class="delimiter">&quot;</span></span>
                             <span class="attribute-name">writer</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">writer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">commit-interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span> <span class="comment">&lt;!-- (3) --&gt;</span>
            <span class="tag">&lt;/batch:tasklet&gt;</span>
        <span class="tag">&lt;/batch:step&gt;</span>
    <span class="tag">&lt;/batch:job&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Explanation</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Sr. No.</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure job.<br>
<code>id</code> attribute must be unique within the scope of all the jobs included in 1 batch application.<br>
Here, <code>jobPointAddChunk</code> is specified as a job name of chunk model.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure step.<br>
It is not necessary to have a unique <code>id</code> attribute within the scope of all the jobs included in 1 batch application, however a unique id is used to enable easy tracking at the time of failure occurrence.<br>
[step + Sr. No.] is added to id attribute specified in (1) unless for a specific reason mentioned.<br>
Here, specify <code>jobPointAddChunk.step01</code> as a step name for the job of chunk model.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(3)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure a chunk model job.<br>
Specify Bean ID of <code>ItemReader</code> and <code>ItemWriter</code> defined in previous section, in respective attributes of <code>reader</code> and <code>writer</code>.<br>
Specify <code>pointAddItemProcessor</code> - a Bean ID of implementation class of ItemProcessor, in <code>processor</code> attribute.+
Set number of input data records for 1 chunk as 10, in <code>commit-interval</code> attribute.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">commit-interval tuning</div>
<div class="paragraph">
<p>commit-interval is a tuning point for performance during a chunk model job.</p>
</div>
<div class="paragraph">
<p>It is set as 10 records in this tutorial, however, the appropriate number of records vary depending on available machine resources and job characteristics.
Process throughput is likely to reach from 10 records to 100 records in case of a job which processes data by accessing multiple resources.
Alternately, if the input and output resources are in 1:1 ratio and there are enough jobs to transfer data, process throughput can reach 5000 to 10000 records as well.</p>
</div>
<div class="paragraph">
<p>It is advisable to temporarily place commit-interval to 100 records while implementing a job and then perform tuning for each job in accordance with the results of performance measurement.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Ch09_DBAccessJob_Chunk_Execution"><a class="anchor" href="#Ch09_DBAccessJob_Chunk_Execution"></a>Job execution and results verification</h3>
<div class="paragraph">
<p>Execute created job on STS and verify results.</p>
</div>
<div class="sect3">
<h4 id="Ch09_DBAccessJob_Chunk_Execution_Run"><a class="anchor" href="#Ch09_DBAccessJob_Chunk_Execution_Run"></a>Execute job from execution configuration</h4>
<div class="paragraph">
<p>Create execution configuration as below and execute job.<br>
For how to create execution configuration, refer <a href="Ch09_EnvironmentConstruction.html#Ch09_EnvironmentConstruction_OperationCheck">Verifying project operations</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Setting value for execution configuration</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Name: Any name (Example: Run DBAccessJob for ChunkModel)</p>
</li>
<li>
<p>Main tab</p>
<div class="ulist">
<ul>
<li>
<p>Project: <code>terasoluna-batch-tutorial</code></p>
</li>
<li>
<p>Main class: <code>org.springframework.batch.core.launch.support.CommandLineJobRunner</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Arguments tab</p>
<div class="ulist">
<ul>
<li>
<p>Program arguments: <code>META-INF/jobs/dbaccess/jobPointAddChunk.xml jobPointAddChunk</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="Ch09_DBAccessJob_Chunk_Execution_Console"><a class="anchor" href="#Ch09_DBAccessJob_Chunk_Execution_Console"></a>Verifying console log</h4>
<div class="paragraph">
<p>Verify that logs are output to console for following details.</p>
</div>
<div class="listingblock">
<div class="title">Console log output example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">[2017/09/12 13:32:32] [main] [o.s.b.c.l.s.SimpleJobLauncher] [INFO ] Job: [FlowJob: [name=jobPointAddChunk]] completed with the following parameters: [{jsr_batch_run_id=484}] and the following status: [COMPLETED]
[2017/09/12 13:32:32] [main] [o.s.c.s.ClassPathXmlApplicationContext] [INFO ] Closing org.springframework.context.support.ClassPathXmlApplicationContext@735f7ae5: startup date [Tue Sep 12 13:32:29 JST 2017]; root of context hierarchy</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Ch09_DBAccessJob_Chunk_Execution_Exitcode"><a class="anchor" href="#Ch09_DBAccessJob_Chunk_Execution_Exitcode"></a>Verifying exit code</h4>
<div class="paragraph">
<p>Verify that the process has terminated successfully, using exit code.<br>
For verification procedure, refer <a href="Ch09_EnvironmentConstruction.html#Ch09_EnvironmentConstruction_OperationCheck_ExecJob_Run">Job execution and results verification</a>.
Verify that the exit code (exit value) is 0 (successful termination).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/ch09/DBAccess/Ch09_DBAccessJob_Confirm_ExitCode_ChunkModel.png" alt="Confirm the Exit Code of DBAccessJob for ChunkModel">
</div>
<div class="title">Verifying exit codes</div>
</div>
</div>
<div class="sect3">
<h4 id="Ch09_DBAccessJob_Chunk_Execution_Table"><a class="anchor" href="#Ch09_DBAccessJob_Chunk_Execution_Table"></a>Verifying member information table</h4>
<div class="paragraph">
<p>Compare contents of member information table before and after update and verify that the contents are in accordance with the verification details.<br>
For verification procedure, refer <a href="Ch09_EnvironmentConstruction.html#Ch09_EnvironmentConstruction_OperationCheck_RefDB">Refer database by using Data Source Explorer</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Verification details</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>status column</p>
<div class="ulist">
<ul>
<li>
<p>Records with "0"(initial status) should not exist</p>
</li>
</ul>
</div>
</li>
<li>
<p>point column</p>
<div class="ulist">
<ul>
<li>
<p>Points are added according to membership type, for point addition</p>
<div class="ulist">
<ul>
<li>
<p>100 points when type column is "G"(gold member)</p>
</li>
<li>
<p>10 points when type column is "N"(normal member)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Records exceeding 1,000,000 points (upper limit value) should not exist</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Details of member information table before and after update are as shown below.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/ch09/DBAccess/Ch09_DBAccessJob_Result_MemberInfoTable.png" alt="Table of member_info">
</div>
<div class="title">Details of member information table before and after update</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Ch09_DBAccessJob_Tasklet"><a class="anchor" href="#Ch09_DBAccessJob_Tasklet"></a>Implementation in tasklet model</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Processes from creation to execution of job which accesses database in tasklet model are implemented by following procedures.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#Ch09_DBAccessJob_Tasklet_JobDefinition">Creating job Bean definition file</a></p>
</li>
<li>
<p><a href="#Ch09_DBAccessJob_Tasklet_Dto">Implementation of DTO</a></p>
</li>
<li>
<p><a href="#Ch09_DBAccessJob_Tasklet_MyBatis">Defining database access by using MyBatis</a></p>
</li>
<li>
<p><a href="#Ch09_DBAccessJob_Tasklet_Logic">Implementation of logic</a></p>
</li>
<li>
<p><a href="#Ch09_DBAccessJob_Tasklet_Execution">Verifying execution of job and results</a></p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="Ch09_DBAccessJob_Tasklet_JobDefinition"><a class="anchor" href="#Ch09_DBAccessJob_Tasklet_JobDefinition"></a>Creating job Bean definition file</h3>
<div class="paragraph">
<p>How to combine elements constituting the job which access database in tasklet model is set in Bean definition file.<br>
Here, only frame and common settings of Bean definition file are described and each configuration element is set in subsequent sections.</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/META-INF/jobs/dbaccess/jobPointAddtasklet.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/context</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:batch</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/batch</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:p</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/p</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:mybatis</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://mybatis.org/schema/mybatis-spring</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span>
             <span class="content">http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd</span>
             <span class="content">http://www.springframework.org/schema/batch http://www.springframework.org/schema/batch/spring-batch.xsd</span>
             <span class="content">http://mybatis.org/schema/mybatis-spring http://mybatis.org/schema/mybatis-spring.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="comment">&lt;!-- (1) --&gt;</span>
    <span class="tag">&lt;import</span> <span class="attribute-name">resource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:META-INF/spring/job-base-context.xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="comment">&lt;!-- (2) --&gt;</span>
    <span class="tag">&lt;context:annotation-config</span><span class="tag">/&gt;</span>

    <span class="comment">&lt;!-- (3) --&gt;</span>
    <span class="tag">&lt;context:component-scan</span> <span class="attribute-name">base-package</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.terasoluna.batch.tutorial.dbaccess.tasklet</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Explanation</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Sr. No.</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Always import settings to read required Bean definitions while using TERASOLUNA Batch 5.x.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable Bean definition by using an annotation.
Use it together with (3) while implementing ItemProcessor and Listener.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(3)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure component scanning.<br>
Specify a package storing components to be used (implementation class of Tasklet etc), in <code>base-package</code> attribute.<br>
Use it together with (2) while defining a Bean using an annotation.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="Ch09_DBAccessJob_Tasklet_Dto"><a class="anchor" href="#Ch09_DBAccessJob_Tasklet_Dto"></a>Implementation of DTO</h3>
<div class="paragraph">
<p>Create a DTO class as a class to retain business data.<br>
Create a DTO class for each table.</p>
</div>
<div class="paragraph">
<p>Since it is used as common in chunk model / tasklet model, it can be skipped if created already.</p>
</div>
<div class="listingblock">
<div class="title">org.terasoluna.batch.tutorial.common.dto.MemberInfoDTO</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.terasoluna.batch.tutorial.common.dto</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">MemberInfoDto</span> {
    <span class="directive">private</span> <span class="predefined-type">String</span> id; <span class="comment">// (1)</span>

    <span class="directive">private</span> <span class="predefined-type">String</span> type; <span class="comment">// (2)</span>

    <span class="directive">private</span> <span class="predefined-type">String</span> status; <span class="comment">// (3)</span>

    <span class="directive">private</span> <span class="type">int</span> point; <span class="comment">// (4)</span>

    <span class="directive">public</span> <span class="predefined-type">String</span> getId() {
        <span class="keyword">return</span> id;
    }

    <span class="directive">public</span> <span class="type">void</span> setId(<span class="predefined-type">String</span> id) {
        <span class="local-variable">this</span>.id = id;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getType() {
        <span class="keyword">return</span> type;
    }

    <span class="directive">public</span> <span class="type">void</span> setType(<span class="predefined-type">String</span> type) {
        <span class="local-variable">this</span>.type = type;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getStatus() {
        <span class="keyword">return</span> status;
    }

    <span class="directive">public</span> <span class="type">void</span> setStatus(<span class="predefined-type">String</span> status) {
        <span class="local-variable">this</span>.status = status;
    }

    <span class="directive">public</span> <span class="type">int</span> getPoint() {
        <span class="keyword">return</span> point;
    }

    <span class="directive">public</span> <span class="type">void</span> setPoint(<span class="type">int</span> point) {
        <span class="local-variable">this</span>.point = point;
    }
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Explanation</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Sr. No.</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define <code>id</code> as a field which corresponds to member id.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define <code>type</code> as a field which corresponds to membership type.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(3)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define <code>status</code> as a field which corresponds to product purchasing flag.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(4)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define <code>point</code> as a field corresponding to points.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="Ch09_DBAccessJob_Tasklet_MyBatis"><a class="anchor" href="#Ch09_DBAccessJob_Tasklet_MyBatis"></a>Defining database access by using MyBatis</h3>
<div class="paragraph">
<p>Implement and configure to access database by using MyBatis.</p>
</div>
<div class="paragraph">
<p>Implement following operations.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#Ch09_DBAccessJob_Tasklet_MyBatis_Repository">Implementation of Repository interface</a></p>
</li>
<li>
<p><a href="#Ch09_DBAccessJob_Tasklet_MyBatis_MapperXML">Creating MapperXML file</a></p>
</li>
<li>
<p><a href="#Ch09_DBAccessJob_Tasklet_MyBatis_Bean">Setting job Bean definition file</a></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Since it is used as common in chunk model / tasklet model, it can be skipped if created already.</p>
</div>
<div class="sect3">
<h4 id="Ch09_DBAccessJob_Tasklet_MyBatis_Repository"><a class="anchor" href="#Ch09_DBAccessJob_Tasklet_MyBatis_Repository"></a>Implementation of Repository interface</h4>
<div class="paragraph">
<p>Create an interface to call SQL which is defined in MapperXML file.<br>
Since implementation class for the interface is automatically generated by MyBatis, the developer only needs to create an interface.</p>
</div>
<div class="listingblock">
<div class="title">org.terasoluna.batch.tutorial.common.repository.MemberInfoRepository</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.terasoluna.batch.tutorial.common.repository</span>;

<span class="keyword">import</span> <span class="include">org.terasoluna.batch.tutorial.common.dto.MemberInfoDto</span>;
<span class="keyword">import</span> <span class="include">java.util.List</span>;

<span class="directive">public</span> <span class="type">interface</span> <span class="class">MemberInfoRepository</span> {
    <span class="predefined-type">List</span>&lt;MemberInfoDto&gt; findAll(); <span class="comment">// (1)</span>

    <span class="type">int</span> updatePointAndStatus(MemberInfoDto memberInfo); <span class="comment">// (2)</span>
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Explanation</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Sr. No.</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define a method corresponding to ID of SQL which is defined in MapperXML file.<br>
Here, a method is defined to fetch all the records from member_info table.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Here, define a method to update point column and status column of member_info table.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Ch09_DBAccessJob_Tasklet_MyBatis_MapperXML"><a class="anchor" href="#Ch09_DBAccessJob_Tasklet_MyBatis_MapperXML"></a>Creating MapperXML file</h4>
<div class="paragraph">
<p>Create a MapperXML file which describes settings of SQL and O/R mapping.<br>
Create MapperXML file for each Repository interface.</p>
</div>
<div class="paragraph">
<p>MapperXML file can be read automatically by storing it in a directory which is in conformance with the rules defined by MyBatis.
Store MapperXML file in the directory at the level same as package layer of Repository interface to enable reading of MapperXML file automatically.</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/org/terasoluna/batch/tutorial/common/repository/MemberInfoRepository.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="doctype">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;
        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>

<span class="comment">&lt;!-- (1) --&gt;</span>
<span class="tag">&lt;mapper</span> <span class="attribute-name">namespace</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.terasoluna.batch.tutorial.common.repository.MemberInfoRepository</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="comment">&lt;!-- (2) --&gt;</span>
    <span class="tag">&lt;select</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">findAll</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">resultType</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.terasoluna.batch.tutorial.common.dto.MemberInfoDto</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        SELECT
            id,
            type,
            status,
            point
        FROM
            member_info
        ORDER BY
            id ASC
    <span class="tag">&lt;/select&gt;</span>

    <span class="comment">&lt;!-- (3) --&gt;</span>
    <span class="tag">&lt;update</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">updatePointAndStatus</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">parameterType</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.terasoluna.batch.tutorial.common.dto.MemberInfoDto</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        UPDATE
            member_info
        SET
            status = #{status},
            point = #{point}
        WHERE
            id = #{id}
    <span class="tag">&lt;/update&gt;</span>
<span class="tag">&lt;/mapper&gt;</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Explanation</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Sr. No.</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify fully qualified class name (FQCN) of Repository interface, in namespace attribute of mapper element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define reference SQL.<br>
Here, configure SQL to fetch all the records from member_info table.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(3)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define update SQL.<br>
Here, set SQL to update status and point for the records that match with
specified id of member_info table.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Ch09_DBAccessJob_Tasklet_MyBatis_Bean"><a class="anchor" href="#Ch09_DBAccessJob_Tasklet_MyBatis_Bean"></a>Setting job Bean definition file</h4>
<div class="paragraph">
<p>Add following (1) ~ (3) to job Bean definition file as a setting to access database by using MyBatis.</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/META-INF/jobs/dbaccess/jobPointAddTasklet.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/context</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:batch</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/batch</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:p</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/p</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:mybatis</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://mybatis.org/schema/mybatis-spring</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span>
             <span class="content">http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd</span>
             <span class="content">http://www.springframework.org/schema/batch http://www.springframework.org/schema/batch/spring-batch.xsd</span>
             <span class="content">http://mybatis.org/schema/mybatis-spring http://mybatis.org/schema/mybatis-spring.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;import</span> <span class="attribute-name">resource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:META-INF/spring/job-base-context.xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;context:annotation-config</span><span class="tag">/&gt;</span>

    <span class="tag">&lt;context:component-scan</span> <span class="attribute-name">base-package</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.terasoluna.batch.tutorial.dbaccess.tasklet</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="comment">&lt;!-- (1) --&gt;</span>
    <span class="tag">&lt;mybatis:scan</span> <span class="attribute-name">base-package</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.terasoluna.batch.tutorial.common.repository</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">factory-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobSqlSessionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="comment">&lt;!-- (2) --&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">reader</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.mybatis.spring.batch.MyBatisCursorItemReader</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">p:queryId</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.terasoluna.batch.tutorial.common.repository.MemberInfoRepository.findAll</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">p:sqlSessionFactory-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobSqlSessionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="comment">&lt;!-- (3) --&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">writer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.mybatis.spring.batch.MyBatisBatchItemWriter</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">p:statementId</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.terasoluna.batch.tutorial.common.repository.MemberInfoRepository.updatePointAndStatus</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">p:sqlSessionTemplate-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">batchModeSqlSessionTemplate</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Explanation</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Sr. No.</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure to scan Repository interface.<br>
Specify a base package which stores Repository interface, in <code>base-package</code> attribute.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure ItemReader.<br>
Specify <code>org.mybatis.spring.batch.MyBatisCursorItemReader</code> provided by Spring linkage library - MyBatis-Spring provided by MyBatis, in <code>class</code> attribute.<br>
Specify <code>namespace</code>+<code>id</code> of SQL set in MapperXML file, in <code>queryId</code> attribute.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(3)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure ItemWriter.<br>
Specify <code>org.mybatis.spring.batch.MyBatisBatchItemWriter</code> provided by MyBatis-Spring - Spring linkage library provided by MyBatis, in <code>class</code> attribute.<br>
Specify <code>namespace</code>+<code>id</code> of SQL set in MapperXML file, in <code>statementId</code> attribute.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Tasklet implementation which use components of chunk model</div>
<div class="paragraph">
<p>In this tutorial, ItemReader . ItemWriter - components of chunk model are used
in order to easily create a job which accesses database in the tasklet model.</p>
</div>
<div class="paragraph">
<p>Refer <a href="Ch03_CreateTaskletJob.html#Ch03_CreateTaskletJob_HowToUse_Implements_InOut">Tasklet implementation which use components of chunk model</a> and determine appropriately
for whether to use various components of chunk model during Tasklet implementation.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Accessing database other than ItemReader and ItemWriter</div>
<div class="paragraph">
<p>A method which use Mapper interface is adopted as a method to access database other than ItemReader and ItemWriter.
Since restrictions are set as TERASOLUNA Batch 5.x while using Mapper interface,
<a href="Ch05_DBAccess.html#Ch05_DBAccess_HowToUse_Processor">Database access other than ItemReader and ItemWriter</a> should be referred.
For Tasklet implementation, refer <a href="Ch05_DBAccess.html#Ch05_DBAccess_HowToUse_Output_MyBatisMapperInterface_Tasklet">database access in Tasklet</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Ch09_DBAccessJob_Tasklet_Logic"><a class="anchor" href="#Ch09_DBAccessJob_Tasklet_Logic"></a>Implementation of logic</h3>
<div class="paragraph">
<p>Implement a business logic class which adds points.</p>
</div>
<div class="paragraph">
<p>Implement following operations.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#Ch09_DBAccessJob_Tasklet_Logic_Tasklet">Implementation of PointAddTasklet class</a></p>
</li>
<li>
<p><a href="#Ch09_DBAccessJob_Tasklet_Logic_Bean">Configuring job Bean definition file</a></p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="Ch09_DBAccessJob_Tasklet_Logic_Tasklet"><a class="anchor" href="#Ch09_DBAccessJob_Tasklet_Logic_Tasklet"></a>Implementation of PointAddTasklet class</h4>
<div class="paragraph">
<p>Implement PointAddTasklet class which implements Tasklet interface.</p>
</div>
<div class="listingblock">
<div class="title">org.terasoluna.batch.tutorial.dbaccess.tasklet.PointAddTasklet</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.terasoluna.batch.tutorial.dbaccess.tasklet</span>;

<span class="keyword">import</span> <span class="include">org.springframework.batch.core.StepContribution</span>;
<span class="keyword">import</span> <span class="include">org.springframework.batch.core.scope.context.ChunkContext</span>;
<span class="keyword">import</span> <span class="include">org.springframework.batch.core.step.tasklet.Tasklet</span>;
<span class="keyword">import</span> <span class="include">org.springframework.batch.item.ItemStreamReader</span>;
<span class="keyword">import</span> <span class="include">org.springframework.batch.item.ItemWriter</span>;
<span class="keyword">import</span> <span class="include">org.springframework.batch.repeat.RepeatStatus</span>;
<span class="keyword">import</span> <span class="include">org.springframework.stereotype.Component</span>;
<span class="keyword">import</span> <span class="include">org.terasoluna.batch.tutorial.common.dto.MemberInfoDto</span>;

<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;
<span class="keyword">import</span> <span class="include">java.util.ArrayList</span>;
<span class="keyword">import</span> <span class="include">java.util.List</span>;

<span class="annotation">@Component</span> <span class="comment">// (1)</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">PointAddTasklet</span> <span class="directive">implements</span> Tasklet {

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> TARGET_STATUS = <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>; <span class="comment">// (2)</span>

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> INITIAL_STATUS = <span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>; <span class="comment">// (3)</span>

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> GOLD_MEMBER = <span class="string"><span class="delimiter">&quot;</span><span class="content">G</span><span class="delimiter">&quot;</span></span>; <span class="comment">// (4)</span>

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> NORMAL_MEMBER = <span class="string"><span class="delimiter">&quot;</span><span class="content">N</span><span class="delimiter">&quot;</span></span>; <span class="comment">// (5)</span>

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">int</span> MAX_POINT = <span class="integer">1000000</span>; <span class="comment">// (6)</span>

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">int</span> CHUNK_SIZE = <span class="integer">10</span>; <span class="comment">// (7)</span>

    <span class="annotation">@Inject</span> <span class="comment">// (8)</span>
    ItemStreamReader&lt;MemberInfoDto&gt; reader; <span class="comment">// (9)</span>

    <span class="annotation">@Inject</span> <span class="comment">// (8)</span>
    ItemWriter&lt;MemberInfoDto&gt; writer; <span class="comment">// (10)</span>

    <span class="annotation">@Override</span>
    <span class="directive">public</span> RepeatStatus execute(StepContribution contribution, ChunkContext chunkContext) <span class="directive">throws</span> <span class="exception">Exception</span> { <span class="comment">// (11)</span>
        MemberInfoDto item = <span class="predefined-constant">null</span>;

        <span class="predefined-type">List</span>&lt;MemberInfoDto&gt; items = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;(CHUNK_SIZE); <span class="comment">// (12)</span>

        <span class="keyword">try</span> {
            reader.open(chunkContext.getStepContext().getStepExecution().getExecutionContext()); <span class="comment">// (13)</span>

            <span class="keyword">while</span> ((item = reader.read()) != <span class="predefined-constant">null</span>) { <span class="comment">// (14)</span>

                <span class="keyword">if</span> (TARGET_STATUS.equals(item.getStatus())) {
                    <span class="keyword">if</span> (GOLD_MEMBER.equals(item.getType())) {
                        item.setPoint(item.getPoint() + <span class="integer">100</span>);
                    } <span class="keyword">else</span> <span class="keyword">if</span> (NORMAL_MEMBER.equals(item.getType())) {
                        item.setPoint(item.getPoint() + <span class="integer">10</span>);
                    }

                    <span class="keyword">if</span> (item.getPoint() &gt; MAX_POINT) {
                        item.setPoint(MAX_POINT);
                    }

                    item.setStatus(INITIAL_STATUS);
                }

                items.add(item);

                <span class="keyword">if</span> (items.size() == CHUNK_SIZE) { <span class="comment">// (15)</span>
                    writer.write(items); <span class="comment">// (16)</span>
                    items.clear();
                }
            }

            writer.write(items); <span class="comment">// (17)</span>
        } <span class="keyword">finally</span> {
            reader.close(); <span class="comment">// (18)</span>
        }

        <span class="keyword">return</span> RepeatStatus.FINISHED; <span class="comment">// (19)</span>
    }
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Explanation</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Sr. No.</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define a Bean by assigning <code>@Component</code> annotation in order to subject it to component scanning.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define product purchasing flag:1 as a constant, for point addition.<br>
Originally, a field constant is defined as a constant class and it is rarely defined in the logic.
It is defined as a constant for the sake of convenience of this tutorial. (Same is applicable to subsequent constants)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(3)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define initial value of product purchasing flag = 0, as a constant.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(4)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define membership type:G (gold member), as a constant.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(5)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define membership type:N (normal member), as a constant.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(6)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define upper limit of points:1000000, as a constant.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(7)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define a unit (fixed records): 10 to be processed together.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(8)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assign <code>@Inject</code> annotation and inject <code>ItemStreamReader/ItemWriter</code> implementation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(9)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define the type as <code>ItemStreamReader</code> - a sub-interface of <code>ItemReader</code> to access database.<br>
<code>ItemStreamReader</code> is required to open / close a resource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(10)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define <code>ItemWriter</code>.<br>
Unlike <code>ItemStreamReader</code>, it is not necessary to open/close a resource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(11)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implement a product purchasing flag, and business logic which adds points according to membership type.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(12)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define a list to store <code>item</code> of fixed records.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(13)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Open an input resource.<br>
A SQL is issued within this timing.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(14)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Process all input resource records sequentially.<br>
<code>ItemReader#read</code> returns <code>null</code> when all the input data has been read.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(15)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determine whether number of <code>item</code> added to the list has reached a certain number of records.<br>
When it reaches a certain number, output it to database in (16) and <code>clear</code> the list.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(16)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Output to database.<br>
It must be noted that it is not committed at this time.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(17)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Output all process records and remaining records to database.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(18)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Close resource.<br>
Note that, exception handling is not implemented here for the ease of implementation. Implement exception handling when necessary.<br>
When an exception occurs, transaction of entire tasklet is rolled back, stack trace of the exception is output and job is terminated abnormally.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(19)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return whether the processing of Tasklet is completed.<br>
Always specify <code>return RepeatStatus.FINISHED;</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Ch09_DBAccessJob_Tasklet_Logic_Bean"><a class="anchor" href="#Ch09_DBAccessJob_Tasklet_Logic_Bean"></a>Configuring job Bean definition file</h4>
<div class="paragraph">
<p>Add following (1) and subsequent objects to job Bean definition file to set the created business logic as a job.</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/META-INF/jobs/dbaccess/jobPointAddTasklet.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/context</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:batch</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/batch</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:p</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/p</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:mybatis</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://mybatis.org/schema/mybatis-spring</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span>
             <span class="content">http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd</span>
             <span class="content">http://www.springframework.org/schema/batch http://www.springframework.org/schema/batch/spring-batch.xsd</span>
             <span class="content">http://mybatis.org/schema/mybatis-spring http://mybatis.org/schema/mybatis-spring.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;import</span> <span class="attribute-name">resource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:META-INF/spring/job-base-context.xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;context:annotation-config</span><span class="tag">/&gt;</span>

    <span class="tag">&lt;context:component-scan</span> <span class="attribute-name">base-package</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.terasoluna.batch.tutorial.dbaccess.tasklet</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;mybatis:scan</span> <span class="attribute-name">base-package</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.terasoluna.batch.tutorial.common.repository</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">factory-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobSqlSessionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">reader</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.mybatis.spring.batch.MyBatisCursorItemReader</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">p:queryId</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.terasoluna.batch.tutorial.common.repository.MemberInfoRepository.findAll</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">p:sqlSessionFactory-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobSqlSessionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">writer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.mybatis.spring.batch.MyBatisBatchItemWriter</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">p:statementId</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.terasoluna.batch.tutorial.common.repository.MemberInfoRepository.updatePointAndStatus</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">p:sqlSessionTemplate-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">batchModeSqlSessionTemplate</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="comment">&lt;!-- (1) --&gt;</span>
    <span class="tag">&lt;batch:job</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobPointAddTasklet</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">job-repository</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobRepository</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;batch:step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobPointAddTasklet.step01</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> <span class="comment">&lt;!-- (2) --&gt;</span>
            <span class="tag">&lt;batch:tasklet</span> <span class="attribute-name">transaction-manager</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobTransactionManager</span><span class="delimiter">&quot;</span></span>
                           <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pointAddTasklet</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span> <span class="comment">&lt;!-- (3) --&gt;</span>
        <span class="tag">&lt;/batch:step&gt;</span>
    <span class="tag">&lt;/batch:job&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Explanation</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Sr. No.</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure job.<br>
<code>id</code> attribute should be unique within the scope of all the jobs included in 1 batch application.<br>
Here, <code>jobPointAddTasklet</code> is specified as a job name of tasklet model.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure step.<br>
It is not necessary to have a unique <code>id</code> attribute within the scope of all the jobs included in 1 batch application, however a unique id is used to enable easy tracking at the time of occurrence of a failure.<br>
Add [step + Sr. No.] to id specified in (1) unless for a specific reason.<br>
Here, specify <code>jobPointAddTasklet.step01</code> as a step name of job for tasklet model.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(3)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure tasklet.<br>
Specify <code>pointAddTasklet</code> - a Bean ID of implementation class of Tasklet, in <code>ref</code> attribute.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="Ch09_DBAccessJob_Tasklet_Execution"><a class="anchor" href="#Ch09_DBAccessJob_Tasklet_Execution"></a>Verifying execution of job and results</h3>
<div class="paragraph">
<p>Execute the created job on STS and verify results.</p>
</div>
<div class="sect3">
<h4 id="Ch09_DBAccessJob_Tasklet_Execution_Run"><a class="anchor" href="#Ch09_DBAccessJob_Tasklet_Execution_Run"></a>Execute job from execution configuration</h4>
<div class="paragraph">
<p>Create execution configuration as below and execute job.<br>
For how to create execution configuration, refer <a href="Ch09_EnvironmentConstruction.html#Ch09_EnvironmentConstruction_OperationCheck">Verify project operations</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Setup value of execution configuration</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Name: Any name (Example: Run DBAccessJob for TaskletModel)</p>
</li>
<li>
<p>Main tab</p>
<div class="ulist">
<ul>
<li>
<p>Project: <code>terasoluna-batch-tutorial</code></p>
</li>
<li>
<p>Main class: <code>org.springframework.batch.core.launch.support.CommandLineJobRunner</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Arguments tab</p>
<div class="ulist">
<ul>
<li>
<p>Program arguments: <code>META-INF/jobs/dbaccess/jobPointAddTasklet.xml jobPointAddTasklet</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="Ch09_DBAccessJob_Tasklet_Execution_Console"><a class="anchor" href="#Ch09_DBAccessJob_Tasklet_Execution_Console"></a>Verifying console log</h4>
<div class="paragraph">
<p>Verify that following details are output in Console.</p>
</div>
<div class="listingblock">
<div class="title">Console log output example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">[2017/09/12 10:09:56] [main] [o.s.b.c.l.s.SimpleJobLauncher] [INFO ] Job: [FlowJob: [name=jobPointAddTasklet]] completed with the following parameters: [{jsr_batch_run_id=472}] and the following status: [COMPLETED]
[2017/09/12 10:09:56] [main] [o.s.c.s.ClassPathXmlApplicationContext] [INFO ] Closing org.springframework.context.support.ClassPathXmlApplicationContext@735f7ae5: startup date [Tue Sep 12 10:09:54 JST 2017]; root of context hierarchy</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Ch09_DBAccessJob_Tasklet_Execution_Exitcode"><a class="anchor" href="#Ch09_DBAccessJob_Tasklet_Execution_Exitcode"></a>Verifying exit codes</h4>
<div class="paragraph">
<p>Verify that the process has terminated successfully, by exit codes.<br>
For verification procedure, refer <a href="Ch09_EnvironmentConstruction.html#Ch09_EnvironmentConstruction_OperationCheck_ExecJob_Run">Job execution and results verification</a>.
Verify that the exit code (exit value) is 0 (Successful termination).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/ch09/DBAccess/Ch09_DBAccessJob_Confirm_ExitCode_TaskletModel.png" alt="Confirm the Exit Code of DBAccessJob for TaskletModel">
</div>
<div class="title">Verifying exit codes</div>
</div>
</div>
<div class="sect3">
<h4 id="Ch09_DBAccessJob_Tasklet_Execution_Table"><a class="anchor" href="#Ch09_DBAccessJob_Tasklet_Execution_Table"></a>Verifying member information table</h4>
<div class="paragraph">
<p>Compare contents of member information table before and after update, and verify that the contents are in accordance with the verification details.<br>
For verification procedure, refer <a href="Ch09_EnvironmentConstruction.html#Ch09_EnvironmentConstruction_OperationCheck_RefDB">Refer database by using Data Source Explorer</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Verification details</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>status column</p>
<div class="ulist">
<ul>
<li>
<p>Records with "0"(initial status) should not exist</p>
</li>
</ul>
</div>
</li>
<li>
<p>point column</p>
<div class="ulist">
<ul>
<li>
<p>Points should be added in accordance with membership type, for point addition</p>
<div class="ulist">
<ul>
<li>
<p>100 points when type column is "G"(gold member)</p>
</li>
<li>
<p>10 points when type column is "N"(normal member)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Records exceeding 1,000,000 points (upper limit) should not exist</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Contents of member information table before and after update are as shown below.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/ch09/DBAccess/Ch09_DBAccessJob_Result_MemberInfoTable.png" alt="Table of member_info">
</div>
<div class="title">Contents of member information table before and after update</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="container">

  <div class="common-bg">
    <div class="information">
      TERASOLUNA Batch Framework for Java (5.x) Development Guideline - version 5.0.1.RELEASE, 2017-9-27
    </div>
    <div class="index">
      <a href="index.html">&gt; INDEX</a>
    </div>
  </div>

  <div class="footer-bg">
    <div class="copyright">
      &copy; Copyright 2017 NTT DATA Corporation.
    </div>
  </div>

</div>
</body>
</html>