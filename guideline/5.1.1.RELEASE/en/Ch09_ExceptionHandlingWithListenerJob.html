<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<title>A job which performs exception handling by ChunkListener</title>
<link rel="stylesheet" href="./theme/css/readthedocs.css">
<link rel="stylesheet" href="./theme/css/font-awesome.min.css">
<link rel="stylesheet" href="./theme/css/coderay-asciidoctor.css">
<link rel="stylesheet" href="./theme/css/header-footer.css">
<title>TERASOLUNA Batch Framework for Java (5.x) Development Guideline</title>

<div class="common-bg">
  <div class="information">
    TERASOLUNA Batch Framework for Java (5.x) Development Guideline - version 5.1.1.RELEASE, 2018-3-16
  </div>
  <div class="index">
    <a href="index.html">&gt; INDEX</a>
  </div>
</div>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8VC2LCPQFM"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());  gtag('config', 'G-8VC2LCPQFM');
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-46550814-2', 'auto');
  ga('send', 'pageview');
</script>
</head>
<body id="Ch09_Impl_ExceptionHandlingWithListenerJob" class="book toc2 toc-left">
<div id="header">
<h1>A job which performs exception handling by ChunkListener</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Overview">Overview</a>
<ul class="sectlevel2">
<li><a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Overview_Background">Background</a></li>
<li><a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Overview_ProcessOverview">Process overview</a></li>
<li><a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Overview_BusinessSpecification">Business specifications</a></li>
<li><a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Overview_TableSpecification">Table specifications</a></li>
<li><a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Overview_JobOverview">Job overview</a></li>
</ul>
</li>
<li><a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk">Implementation in chunk model</a>
<ul class="sectlevel2">
<li><a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk_MessageDefinition">Adding message definition</a></li>
<li><a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk_Coding">Implementation of exception handling</a>
<ul class="sectlevel3">
<li><a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk_Coding_Listener">Implementation of ChunkErrorLoggingListener class</a></li>
<li><a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk_Coding_Bean">Configuring Job Bean definition file</a></li>
</ul>
</li>
<li><a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk_Execution">Job execution and results verification</a>
<ul class="sectlevel3">
<li><a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk_Execution_Run">Execute job from execution configuration</a></li>
<li><a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk_Execution_Console">Verifying console log</a></li>
<li><a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk_Execution_Exitcode">Verifying exit code</a></li>
<li><a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk_Execution_Output">Verifying output resource</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet">Implementation in tasklet model</a>
<ul class="sectlevel2">
<li><a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet_MessageDefinition">Adding message definition</a></li>
<li><a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet_Coding">Implementation of exception handling</a>
<ul class="sectlevel3">
<li><a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet_Coding_Listener">Implementation of ChunkErrorLoggingListener class</a></li>
<li><a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet_Coding_Bean">Configuring job Bean definition file</a></li>
</ul>
</li>
<li><a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet_Execution">Job execution and results verification</a>
<ul class="sectlevel3">
<li><a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet_Execution_Run">Execute a job from execution configuration</a></li>
<li><a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet_Execution_Console">Verifying console log</a></li>
<li><a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet_Execution_Exitcode">Verifying exit codes</a></li>
<li><a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet_Execution_Output">Verifying output resource</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div id="Ch09_Impl_ExceptionHandlingWithListenerJob_Prerequisite" class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Premise</div>
<div class="paragraph">
<p>As explained in <a href="Ch09_Introduction.html#Ch09_Introduction_HowToProceed">How to proceed in the tutorial</a>,
it is a format to add implementation of exception handling for <a href="Ch09_ValidationJob.html#Ch09_Impl_ValidationJob">jobs that validate input data</a>
Note that, various methods like try-catch or ChunkListener are used as exception handling methods.<br>
However, it must be noted that the explanation is for the case wherein the implementation is added to the job which accesses the database.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Ch09_Impl_ExceptionHandlingWithListenerJob_Overview"><a class="anchor" href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Create a job which performs exception handling by ChunkListener.</p>
</div>
<div class="paragraph">
<p>Note that, since this section is explained based on TERASOLUNA Batch 5.x Development guideline,
refer to <a href="Ch06_ExceptionHandling.html#Ch06_ExceptionHandling_HowToUse_StepExceptionHandling_ChunkListener">Exception handling by ChunkListener interface</a> for details.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Regarding usage of listener</div>
<div class="paragraph">
<p>By using a listener, exception handling is implemented by checking that the exception has occurred after execution of step here.
However, since the use of listener is not restricted to exception handling, refer Listener for details.
refer <a href="Ch04_Listener.html#Ch04_Listener">Listener</a> for details.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Background, process overview and business specifications of <a href="Ch09_TutorialApplication.html#Ch09_TutorialApplication">Explanation of application to be created</a>
are listed below.</p>
</div>
<div class="sect2">
<h3 id="Ch09_Impl_ExceptionHandlingWithListenerJob_Overview_Background"><a class="anchor" href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Overview_Background"></a>Background</h3>
<div class="paragraph">
<p>Some mass retail stores issue point cards to the members. <br>
Membership types include "Gold members", "Normal members" and the services are provided based on membership type.<br>
As a part of the service, 100 points are added for "gold members" and 10 points are added for "normal members" at the end of the month,
for the members who have purchased a product during that month.</p>
</div>
</div>
<div class="sect2">
<h3 id="Ch09_Impl_ExceptionHandlingWithListenerJob_Overview_ProcessOverview"><a class="anchor" href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Overview_ProcessOverview"></a>Process overview</h3>
<div class="paragraph">
<p>TERASOLUNA Batch 5.x will be using an application as a monthly batch process which adds
points based on the membership type.<br>
A process to validate verification for checking whether the input data exceeds upper limit value of points is additionally implemented,
a log is output at the time of error and the process is abnormally terminated.</p>
</div>
</div>
<div class="sect2">
<h3 id="Ch09_Impl_ExceptionHandlingWithListenerJob_Overview_BusinessSpecification"><a class="anchor" href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Overview_BusinessSpecification"></a>Business specifications</h3>
<div class="paragraph">
<p>Business specifications are as shown below.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Check that the input data points do not exceed 1,000,000 points</p>
<div class="ulist">
<ul>
<li>
<p>When an error occurs during a process, an error message is output in a log and process is terminated abnormally</p>
</li>
<li>
<p>Error message is handled through subsequent processing by using a listener</p>
</li>
<li>
<p>Message content is read as "The Point exceeds 1000000."</p>
</li>
</ul>
</div>
</li>
<li>
<p>When the product purchasing flag is "1"(process target), points are added based on membership type</p>
<div class="ulist">
<ul>
<li>
<p>Add 100 points when membership type is "G"(gold member),and add 10 points when membership type is "N" (normal member).</p>
</li>
</ul>
</div>
</li>
<li>
<p>Product purchasing flag is updated to "0" (initial status) after adding points</p>
</li>
<li>
<p>Upper limit of points is 1,000,000 points</p>
</li>
<li>
<p>If the points exceed 1,000,000 points after adding points, they are adjusted to 1,000,000 points.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Ch09_Impl_ExceptionHandlingWithListenerJob_Overview_TableSpecification"><a class="anchor" href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Overview_TableSpecification"></a>Table specifications</h3>
<div class="paragraph">
<p>Specifications of member information table acting as an input and output resource are shown below.<br>
Since it acts as an explanation for the job which accesses the database as per <a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Prerequisite">Premise</a>
refer <a href="Ch09_FileAccessJob.html#Ch09_Impl_FileAccessJob_Overview_FileSpecification">File specifications</a> for resource specifications of input and output in case of a job accessing the file.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Member information table (member_info)</caption>
<colgroup>
<col style="width: 3.0927%;">
<col style="width: 15.4639%;">
<col style="width: 10.3092%;">
<col style="width: 4.1237%;">
<col style="width: 12.3711%;">
<col style="width: 8.2474%;">
<col style="width: 46.392%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">No</th>
<th class="tableblock halign-left valign-top">Attribute name</th>
<th class="tableblock halign-left valign-top">Column name</th>
<th class="tableblock halign-left valign-top">PK</th>
<th class="tableblock halign-left valign-top">Data type</th>
<th class="tableblock halign-left valign-top">Number of digits</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Member Id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CHAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates a fixed 8 digit number which uniquely identifies a member.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Membership type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CHAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Membership types are as shown below.<br>
"G"(Gold member), "N"(Normal member)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Product purchasing flag</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CHAR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates whether you have purchased a product during the month.<br>
When the product is purchased, it is updated to "1"(process target) and to "0"(initial status) during monthly batch processing.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Point</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">point</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates points retained by the member.<br>
Initial value is 0.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="Ch09_Impl_ExceptionHandlingWithListenerJob_Overview_JobOverview"><a class="anchor" href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Overview_JobOverview"></a>Job overview</h3>
<div class="paragraph">
<p>Process flow and process sequence are shown below in order to understand
the overview of the job which performs input check created here.</p>
</div>
<div class="paragraph">
<p>Since it acts as an explanation for the job which accesses the database as per <a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Prerequisite">Premise</a>,
it must be noted that parts different from that of a process flow and process sequence in case of a job accessing the file exists.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Process flow overview</dt>
<dd>
<p>Process flow overview is shown below.</p>
</dd>
</dl>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/ch09/ExceptionHandlingWithListener/Ch09_ExceptionHandlingWithListenerJob_ProcessFlow.png" alt="ProcessFlow of ExceptionHandlingWithListener Job">
</div>
<div class="title">Process flow of job which performs exception handling</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Process sequence in case of a chunk model</dt>
<dd>
<p>Process sequence is explained in case of a chunk model.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Process sequence is explained in case of a chunk model.<br>
Since this job is explained assuming usage of abnormal data,
the sequence diagram indicates that error (abnormal termination) has occurred during input check.<br>
When input check is successful, process sequence after input check is same as sequence diagram
(Refer <a href="Ch09_DBAccessJob.html#Ch09_Impl_DBAccessJob_Overview_JobOverview">Job overview</a>) of database access.</p>
</div>
<div class="paragraph">
<p>Orange object indicates a class to be implemented at that time.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/Ch09_ExceptionHandlingWithListenerJob_ProcessSequence_ChunkModel.png" alt="ProcessSequence of ExceptionHandlingWithListener Job by ChunkModel">
</div>
<div class="title">Sequence diagram of chunk model</div>
</div>
<div class="olist arabic">
<div class="title">Explanation of sequence diagram</div>
<ol class="arabic">
<li>
<p>Step is executed from the job.</p>
</li>
<li>
<p>Step opens a resource.</p>
</li>
<li>
<p><code>MyBatisCursorItemReader</code> fetches all the member information from member_info table  (issue select statement).</p>
<div class="ulist">
<ul>
<li>
<p>Repeat subsequent processes until input data is exhausted.</p>
</li>
<li>
<p>Start a framework transaction in chunk units.</p>
</li>
<li>
<p>Repeat processes from 4 to 12 until chunk size is reached.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Step fetches 1 record of input data from <code>MyBatisCursorItemReader</code>.</p>
</li>
<li>
<p><code>MyBatisCursorItemReader</code> fetches 1 record of input data from member_info table.</p>
</li>
<li>
<p>member_info table returns input data to <code>MyBatisCursorItemReader</code>.</p>
</li>
<li>
<p><code>MyBatisCursorItemReader</code> returns input data to step.</p>
</li>
<li>
<p>Step performs a process for input data by <code>PointAddItemProcessor</code>.</p>
</li>
<li>
<p><code>PointAddItemProcessor</code> requests an input check process to <code>SpringValidator</code>.</p>
</li>
<li>
<p><code>SpringValidator</code> performs input check based on input check rules and throws an exception (ValidationException) when an error occurs during checking.</p>
</li>
<li>
<p><code>PointAddItemProcessor</code> adds the points by reading input data.</p>
</li>
<li>
<p><code>PointAddItemProcessor</code> returns process results to step.</p>
</li>
<li>
<p>Step outputs chunk size data in <code>MyBatisBatchItemWriter</code>.</p>
</li>
<li>
<p><code>MyBatisBatchItemWriter</code> updates member information for member_info table (issue update statement) .</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When <strong>an exception occurs</strong> in the processes from 4 to 14, perform the subsequent process.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="15">
<li>
<p>Step rolls back a framework transaction.</p>
</li>
<li>
<p>Step executes <code>ChunkErrorLoggingListener</code>.</p>
</li>
<li>
<p><code>ChunkErrorLoggingListener</code> outputs ERROR log.</p>
</li>
<li>
<p>Step returns exit code (here, abnormal termination:255) to the job.</p>
</li>
</ol>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Process sequence in case of a tasklet model</dt>
<dd>
<p>Process sequence in case of a tasklet model is explained.<br>
Since this job is explained assuming usage of abnormal data,
the sequence diagram indicates that error (abnormal termination) has occurred during input check.<br>
When input check is successful, process sequence after input check is same as sequence diagram of
(Refer <a href="Ch09_DBAccessJob.html#Ch09_Impl_DBAccessJob_Overview_JobOverview">Job overview</a>) of database access.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Orange object indicates a class to be implemented at that time.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/Ch09_ExceptionHandlingWithListenerJob_ProcessSequence_TaskletModel.png" alt="ProcessSequence of ExceptionHandlingWithListener Job by TaskletModel">
</div>
<div class="title">Sequence diagram of tasklet model</div>
</div>
<div class="olist arabic">
<div class="title">Explanation of sequence diagram</div>
<ol class="arabic">
<li>
<p>Step is executed from the job.</p>
<div class="ulist">
<ul>
<li>
<p>Step starts a framework transaction.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Step executes <code>PointAddTasklet</code>.</p>
</li>
<li>
<p><code>PointAddTasklet</code> opens a resource.</p>
</li>
<li>
<p><code>MyBatisCursorItemReader</code> fetches all the member information from member_info table (issue select statement).</p>
<div class="ulist">
<ul>
<li>
<p>Repeat processes from 5 to 13 until input data is exhausted.</p>
</li>
<li>
<p>Repeat the processes from 5 to 11 until a certain number of records is reached.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>PointAddTasklet</code> fetches 1 record of input data from <code>MyBatisCursorItemReader</code>.</p>
</li>
<li>
<p><code>MyBatisCursorItemReader</code> fetches 1 record of input data from member_info table.</p>
</li>
<li>
<p>member_info table returns input data to <code>MyBatisCursorItemReader</code>.</p>
</li>
<li>
<p><code>MyBatisCursorItemReader</code> returns input data to tasklet.</p>
</li>
<li>
<p><code>PointAddTasklet</code> requests input check process to <code>SpringValidator</code>.</p>
</li>
<li>
<p><code>SpringValidator</code> performs input check based on input check rules and throws an exception (ValidationException) when an error occurs during the checking.</p>
</li>
<li>
<p><code>PointAddTasklet</code> adds points by reading input data.</p>
</li>
<li>
<p><code>PointAddTasklet</code> outputs a certain records of data by <code>MyBatisBatchItemWriter</code>.</p>
</li>
<li>
<p><code>MyBatisBatchItemWriter</code> updates member information for member_info table (issue update statement).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When <strong>an exception occurs</strong> in the processes from 2 to 13, perform the subsequent process.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="14">
<li>
<p><code>PointAddTasklet</code> throws an exception (Here, ValidationException) in step.</p>
</li>
<li>
<p>Step rolls back the framework transaction.</p>
</li>
<li>
<p>Step executes <code>ChunkErrorLoggingListener</code>.</p>
</li>
<li>
<p><code>ChunkErrorLoggingListener</code> outputs ERROR log.</p>
</li>
<li>
<p>Step returns an exit code (here, abnormal termination:255) to the job.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>How to implement for chunk model and tasklet model are further explained.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk">Implementation in chunk model</a></p>
</li>
<li>
<p><a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet">Implementation in tasklet model</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk"><a class="anchor" href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk"></a>Implementation in chunk model</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Processes from creation to execution of job which performs input check in chunk model are implemented with the following processes.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk_MessageDefinition">Adding message definition</a></p>
</li>
<li>
<p><a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk_Coding">Implementation of exception handling</a></p>
</li>
<li>
<p><a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk_Execution">Job execution and results verification</a></p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk_MessageDefinition"><a class="anchor" href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk_MessageDefinition"></a>Adding message definition</h3>
<div class="paragraph">
<p>Log message uses message definition and is used at the time of log output to make it easier
to design prevention of variations in the code system and extraction of keywords to be monitored.</p>
</div>
<div class="paragraph">
<p>Since it is used as common in the chunk model / tasklet model, it can be skipped if created already.</p>
</div>
<div class="paragraph">
<p>Set <code>application-messages.properties</code> and <code>launch-context.xml</code> as shown below.<br>
<code>launch-context.xml</code> is already configured in TERASOLUNA Batch 5.x.</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/i18n/application-messages.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"># (1)
errors.maxInteger=The {0} exceeds {1}.</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/main/resources/META-INF/spring/launch-context.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- omitted --&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.context.support.ResourceBundleMessageSource</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">p:basenames</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">i18n/application-messages</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span> <span class="comment">&lt;!-- (2) --&gt;</span>

<span class="comment">&lt;!-- omitted --&gt;</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Explanation</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Sr. No.</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set the message to be output when the upper limit of points is exceeded.<br>
Assign item name to {0) and upper limit value to {1}.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set <code>MessageSource</code> to use the message from the property file.<br>
Specify storage location of property file in <code>basenames</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk_Coding"><a class="anchor" href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk_Coding"></a>Implementation of exception handling</h3>
<div class="paragraph">
<p>Implement exception handling process.</p>
</div>
<div class="paragraph">
<p>Implement following processes.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk_Coding_Listener">Implementation of ChunkErrorLoggingListener class</a></p>
</li>
<li>
<p><a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk_Coding_Bean">Configuring Job Bean definition file</a></p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk_Coding_Listener"><a class="anchor" href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk_Coding_Listener"></a>Implementation of ChunkErrorLoggingListener class</h4>
<div class="paragraph">
<p>Perform exception handling by using ChunkListener interface.<br>
Implement the process which output ERROR log when an exception occurs, as an implementation class of ChunkListener interface.</p>
</div>
<div class="listingblock">
<div class="title">org.terasoluna.batch.tutorial.common.listener.ChunkErrorLoggingListener</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.terasoluna.batch.tutorial.common.listener</span>;

<span class="keyword">import</span> <span class="include">org.slf4j.Logger</span>;
<span class="keyword">import</span> <span class="include">org.slf4j.LoggerFactory</span>;
<span class="keyword">import</span> <span class="include">org.springframework.batch.core.ChunkListener</span>;
<span class="keyword">import</span> <span class="include">org.springframework.batch.core.scope.context.ChunkContext</span>;
<span class="keyword">import</span> <span class="include">org.springframework.batch.item.validator.ValidationException</span>;
<span class="keyword">import</span> <span class="include">org.springframework.context.MessageSource</span>;
<span class="keyword">import</span> <span class="include">org.springframework.stereotype.Component</span>;

<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;
<span class="keyword">import</span> <span class="include">java.util.Locale</span>;

<span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ChunkErrorLoggingListener</span> <span class="directive">implements</span> ChunkListener {
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Logger</span> logger = LoggerFactory.getLogger(ChunkErrorLoggingListener.class);

    <span class="annotation">@Inject</span>
    MessageSource messageSource; <span class="comment">// (1)</span>

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> beforeChunk(ChunkContext chunkContext) {
        <span class="comment">// do nothing.</span>
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> afterChunk(ChunkContext chunkContext) {
        <span class="comment">// do nothing.</span>
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> afterChunkError(ChunkContext chunkContext) {
        <span class="exception">Exception</span> e = (<span class="exception">Exception</span>) chunkContext.getAttribute(ChunkListener.ROLLBACK_EXCEPTION_KEY); <span class="comment">// (2)</span>
        <span class="keyword">if</span> (e <span class="keyword">instanceof</span> ValidationException) {
            logger.error(messageSource
                    .getMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">errors.maxInteger</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> <span class="predefined-type">String</span><span class="type">[]</span> { <span class="string"><span class="delimiter">&quot;</span><span class="content">Point</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1000000</span><span class="delimiter">&quot;</span></span> }, <span class="predefined-type">Locale</span>.getDefault())); <span class="comment">// (3)</span>
        }
    }
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Explanation</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Sr. No.</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inject an instance of <code>ResourceBundleMessageSource</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fetch the value of the exception occurred which is set using the key <code>ROLLBACK_EXCEPTION_KEY</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(3)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fetch a message with message ID <code>errors.maxInteger</code> from the property file and output in a log.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk_Coding_Bean"><a class="anchor" href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk_Coding_Bean"></a>Configuring Job Bean definition file</h4>
<div class="paragraph">
<p>Configuration of job Bean definition file to perform exception handling with ChunkListener is shown below.</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/META-INF/jobs/dbaccess/jobPointAddChunk.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/context</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:batch</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/batch</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:p</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/p</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:mybatis</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://mybatis.org/schema/mybatis-spring</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span>
             <span class="content">http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd</span>
             <span class="content">http://www.springframework.org/schema/batch http://www.springframework.org/schema/batch/spring-batch.xsd</span>
             <span class="content">http://mybatis.org/schema/mybatis-spring http://mybatis.org/schema/mybatis-spring.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="comment">&lt;!-- omitted --&gt;</span>

    <span class="tag">&lt;context:component-scan</span> <span class="attribute-name">base-package</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.terasoluna.batch.tutorial.dbaccess.chunk,</span>
            <span class="content">org.terasoluna.batch.tutorial.common.listener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span> <span class="comment">&lt;!-- (1) --&gt;</span>

    <span class="comment">&lt;!-- omitted --&gt;</span>

    <span class="tag">&lt;batch:job</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobPointAddChunk</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">job-repository</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobRepository</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;batch:step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobPointAddChunk.step01</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;batch:tasklet</span> <span class="attribute-name">transaction-manager</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobTransactionManager</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;batch:chunk</span> <span class="attribute-name">reader</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">reader</span><span class="delimiter">&quot;</span></span>
                             <span class="attribute-name">processor</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pointAddItemProcessor</span><span class="delimiter">&quot;</span></span>
                             <span class="attribute-name">writer</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">writer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">commit-interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;batch:listeners&gt;</span>
                    <span class="tag">&lt;batch:listener</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">chunkErrorLoggingListener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span> <span class="comment">&lt;!--(2)--&gt;</span>
                <span class="tag">&lt;/batch:listeners&gt;</span>
            <span class="tag">&lt;/batch:tasklet&gt;</span>
        <span class="tag">&lt;/batch:step&gt;</span>
    <span class="tag">&lt;/batch:job&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Explanation</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Sr. No.</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure a base package subjected to component scanning.<br>
Specify an additional package containing implementation class of <code>ChunkListener</code>, in <code>base-package</code> attribute.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set implementation class of <code>StepListener</code>.
Note that, <code>ChunkListener</code> is an extended interface of <code>StepListener</code>.<br>
Here, specify <code>chunkErrorLoggingListener</code> that is a Bean ID of implementation class of ChunkListener.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk_Execution"><a class="anchor" href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk_Execution"></a>Job execution and results verification</h3>
<div class="paragraph">
<p>Execute created job on STS and verify the results.</p>
</div>
<div class="sect3">
<h4 id="Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk_Execution_Run"><a class="anchor" href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk_Execution_Run"></a>Execute job from execution configuration</h4>
<div class="paragraph">
<p>Execute job from already created execution configuration.</p>
</div>
<div class="paragraph">
<p>Here, execute job by using abnormal system data.<br>
Since how to change input data varies based on the resource (database or file) which handles the job of implementing input check,
execute as below.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">When input check is to be implemented for a job which inputs or outputs data by accessing the database</dt>
<dd>
<p>Execute job by using execution configuration created in <a href="Ch09_DBAccessJob.html#Ch09_Impl_DBAccessJob_Chunk_Execution_Run">Execute job from execution configuration</a>
of a job which inputs or outputs data by accessing a database.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Comment out script of normal system data and cancel comment out of abnormal system data script by Database Initialize of <code>batch-application.proeprties</code>
in order to use abnormal system data.</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/batch-application.proeprties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"># Database Initialize
tutorial.create-table.script=file:sqls/create-member-info-table.sql
#tutorial.insert-data.script=file:sqls/insert-member-info-data.sql
tutorial.insert-data.script=file:sqls/insert-member-info-error-data.sql</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">When input check is implemented for the job which inputs or outputs data by accessing a file</dt>
<dd>
<p>Execute job by using execution configuration created in <a href="Ch09_FileAccessJob.html#Ch09_Impl_FileAccessJob_Chunk_Execution_Run">Execute job from execution configuration</a>
of the job which inputs or outputs data by accessing a file.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Change input file (inputFile) path from normal system data (insert-member-info-data.csv) to abnormal system data (insert-member-info-error-data.csv),
from the arguments configured by execution configuration in order to use abnormal system data.</p>
</div>
</div>
<div class="sect3">
<h4 id="Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk_Execution_Console"><a class="anchor" href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk_Execution_Console"></a>Verifying console log</h4>
<div class="paragraph">
<p>Open Console View and verify that log of following details is output.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Process has terminated abnormally (FAILED)</p>
</li>
<li>
<p><code>org.springframework.batch.item.validator.ValidationException</code> has occurred</p>
</li>
<li>
<p><code>org.terasoluna.batch.tutorial.common.listener.ChunkErrorLoggingListener</code> outputs following message as an ERROR log</p>
<div class="ulist">
<ul>
<li>
<p>"The Point exceeds 1000000."</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example of console log output</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">[2017/09/12 11:13:52] [main] [o.t.b.t.c.l.ChunkErrorLoggingListener] [ERROR] The Point exceeds 1000000.
[2017/09/12 11:13:52] [main] [o.s.b.c.s.AbstractStep] [ERROR] Encountered an error executing step jobPointAddChunk.step01 in job jobPointAddChunk
org.springframework.batch.item.validator.ValidationException: Validation failed for org.terasoluna.batch.tutorial.common.dto.MemberInfoDto@6c8a68c1:
Field error in object 'item' on field 'point': rejected value [1000001]; codes [Max.item.point,Max.point,Max.int,Max]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [item.point,point]; arguments []; default message [point],1000000]; default message [must be less than or equal to 1000000]
        at org.springframework.batch.item.validator.SpringValidator.validate(SpringValidator.java:54)

(.. omitted)

[2017/09/12 11:13:52] [main] [o.s.b.c.l.s.SimpleJobLauncher] [INFO ] Job: [FlowJob: [name=jobPointAddChunk]] completed with the following parameters: [{jsr_batch_run_id=480}] and the following status: [FAILED]
[2017/09/12 11:13:52] [main] [o.s.c.s.ClassPathXmlApplicationContext] [INFO ] Closing org.springframework.context.support.ClassPathXmlApplicationContext@735f7ae5: startup date [Tue Sep 12 11:13:50 JST 2017]; root of context hierarchy</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk_Execution_Exitcode"><a class="anchor" href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk_Execution_Exitcode"></a>Verifying exit code</h4>
<div class="paragraph">
<p>Verify that the process has terminated abnormally, using exit codes.<br>
For verification, refer <a href="Ch09_EnvironmentConstruction.html#Ch09_EnvironmentConstruction_OperationCheck_ExecJob_Run">Job execution and results verification</a>.
Verify that the exit code (exit value) is 255 (abnormal termination).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/ch09/ExceptionHandlingWithListener/Ch09_ExceptionHandlingWithListenerJob_ExitCode_ChunkModel.png" alt="Confirm the Exit Code of ExceptionHandlingWithListenerJob for ChunkModel">
</div>
<div class="title">Verifying exit codes</div>
</div>
</div>
<div class="sect3">
<h4 id="Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk_Execution_Output"><a class="anchor" href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk_Execution_Output"></a>Verifying output resource</h4>
<div class="paragraph">
<p>Verify an output resource (database or file) by a job which implements input check.</p>
</div>
<div class="paragraph">
<p>In case of a chunk model, verify the update is confirmed upto the chunk just prior the error location since intermediate commit is being adopted.</p>
</div>
<div class="sect4">
<h5 id="Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk_Execution_Output_Table"><a class="anchor" href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk_Execution_Output_Table"></a>Verifying member information table</h5>
<div class="paragraph">
<p>Verify member information table by using Data Source Explorer.<br>
Compare the contents of member information table before and after update, and verify that the contents are in accordance with the verification details.<br>
For verification details, refer <a href="Ch09_EnvironmentConstruction.html#Ch09_EnvironmentConstruction_OperationCheck_RefDB">Refer database by using Data Source Explorer</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Verification details</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Regarding records from 1 to 10 (records with member ID from "00000001" to "00000010")</p>
<div class="ulist">
<ul>
<li>
<p>status column</p>
<div class="ulist">
<ul>
<li>
<p>Records with "0"(initial status) should not exist</p>
</li>
</ul>
</div>
</li>
<li>
<p>point column</p>
<div class="ulist">
<ul>
<li>
<p>Points should be added according to membership type, for points addition</p>
<div class="ulist">
<ul>
<li>
<p>100 points when type column is "G" (gold member)</p>
</li>
<li>
<p>10 points when type column is "N"(normal member)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Regarding records from 11 to 15 (records with member ID from "00000011" to "00000015")</p>
<div class="ulist">
<ul>
<li>
<p>Should not be updated</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Contents of member information table before and after update are shown below.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/ch09/ExceptionHandlingWithListener/Ch09_ExceptionHandlingWithListenerJob_Result_MemberInfoTable.png" alt="Table of member_info">
</div>
<div class="title">Contents of member information table before and after update</div>
</div>
</div>
<div class="sect4">
<h5 id="Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk_Execution_Output_File"><a class="anchor" href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Chunk_Execution_Output_File"></a>Verifying member information file</h5>
<div class="paragraph">
<p>Compare input and output contents of member information file and verify that the contents are in accordance with verification details.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Verification details</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Member information file should be output in the output directory</p>
<div class="ulist">
<ul>
<li>
<p>Output file: files/output/output-member-info-data.csv</p>
</li>
</ul>
</div>
</li>
<li>
<p>Output records should be only for records 1 to 10 (records with member ID from "00000001" to "00000010")</p>
</li>
<li>
<p>Regarding output records</p>
<div class="ulist">
<ul>
<li>
<p>status column</p>
<div class="ulist">
<ul>
<li>
<p>Records with "0"(initial status) should not exist</p>
</li>
</ul>
</div>
</li>
<li>
<p>point column</p>
<div class="ulist">
<ul>
<li>
<p>Points should be added based on membership type, for point addition</p>
<div class="ulist">
<ul>
<li>
<p>100 points when type column is "G"(gold member)</p>
</li>
<li>
<p>10 points when type column is "N"(normal member)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Input and output details of member information file are shown below.<br>
File fields are output in the sequence of id (member id), type (membership type), status(product purchasing flag) and point(points).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/ch09/ExceptionHandlingWithListener/Ch09_ExceptionHandlingWithListenerJob_Result_MemberInfoFile.png" alt="File of member_info">
</div>
<div class="title">Input and output details of member information file</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet"><a class="anchor" href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet"></a>Implementation in tasklet model</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Implement the processes from creation to execution of a job which performs input check in tasklet model using following procedures.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet_MessageDefinition">Adding message definition</a></p>
</li>
<li>
<p><a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet_Coding">Implementation of exception handling</a></p>
</li>
<li>
<p><a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet_Execution">Job execution and results verification</a></p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet_MessageDefinition"><a class="anchor" href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet_MessageDefinition"></a>Adding message definition</h3>
<div class="paragraph">
<p>Log message uses message definition and is used at the time of log output to make it easier
to design prevention of variations in the code system and extraction of keywords to be monitored.</p>
</div>
<div class="paragraph">
<p>Since it is used as a common in the chunk model / tasklet model, it can be skipped if created already.</p>
</div>
<div class="paragraph">
<p>Configure <code>application-messages.properties</code> and <code>launch-context.xml</code> as shown below.<br>
<code>launch-context.xml</code> is already configured in TERASOLUNA Batch 5.x.</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/i18n/application-messages.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"># (1)
errors.maxInteger=The {0} exceeds {1}.</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/main/resources/META-INF/spring/launch-context.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- omitted --&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.context.support.ResourceBundleMessageSource</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">p:basenames</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">i18n/application-messages</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span> <span class="comment">&lt;!-- (2) --&gt;</span>

<span class="comment">&lt;!-- omitted --&gt;</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Explanation</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Sr. No.</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure a message to be output when the upper limit of points is exceeded.<br>
Assign item name to {0) and upper limit value to {1}.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set <code>MessageSource</code> to use the message from the property file.<br>
Specify storage location of property file in <code>basenames</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet_Coding"><a class="anchor" href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet_Coding"></a>Implementation of exception handling</h3>
<div class="paragraph">
<p>Implement exception handling process.</p>
</div>
<div class="paragraph">
<p>Implement following processes.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet_Coding_Listener">Implementation of ChunkErrorLoggingListener class</a></p>
</li>
<li>
<p><a href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet_Coding_Bean">Configuring job Bean definition file</a></p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet_Coding_Listener"><a class="anchor" href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet_Coding_Listener"></a>Implementation of ChunkErrorLoggingListener class</h4>
<div class="paragraph">
<p>Perform exception handling by using ChunkListener interface.<br>
Implement the process which output ERROR log when an exception occurs, as an implementation class of ChunkListener interface.</p>
</div>
<div class="listingblock">
<div class="title">org.terasoluna.batch.tutorial.common.listener.ChunkErrorLoggingListener</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.terasoluna.batch.tutorial.common.listener</span>;

<span class="keyword">import</span> <span class="include">org.slf4j.Logger</span>;
<span class="keyword">import</span> <span class="include">org.slf4j.LoggerFactory</span>;
<span class="keyword">import</span> <span class="include">org.springframework.batch.core.ChunkListener</span>;
<span class="keyword">import</span> <span class="include">org.springframework.batch.core.scope.context.ChunkContext</span>;
<span class="keyword">import</span> <span class="include">org.springframework.batch.item.validator.ValidationException</span>;
<span class="keyword">import</span> <span class="include">org.springframework.context.MessageSource</span>;
<span class="keyword">import</span> <span class="include">org.springframework.stereotype.Component</span>;

<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;
<span class="keyword">import</span> <span class="include">java.util.Locale</span>;

<span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ChunkErrorLoggingListener</span> <span class="directive">implements</span> ChunkListener {
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Logger</span> logger = LoggerFactory.getLogger(ChunkErrorLoggingListener.class);

    <span class="annotation">@Inject</span>
    MessageSource messageSource; <span class="comment">// (1)</span>

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> beforeChunk(ChunkContext chunkContext) {
        <span class="comment">// do nothing.</span>
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> afterChunk(ChunkContext chunkContext) {
        <span class="comment">// do nothing.</span>
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> afterChunkError(ChunkContext chunkContext) {
        <span class="exception">Exception</span> e = (<span class="exception">Exception</span>) chunkContext.getAttribute(ChunkListener.ROLLBACK_EXCEPTION_KEY); <span class="comment">// (2)</span>
        <span class="keyword">if</span> (e <span class="keyword">instanceof</span> ValidationException) {
            logger.error(messageSource
                    .getMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">errors.maxInteger</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> <span class="predefined-type">String</span><span class="type">[]</span> { <span class="string"><span class="delimiter">&quot;</span><span class="content">Point</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1000000</span><span class="delimiter">&quot;</span></span> }, <span class="predefined-type">Locale</span>.getDefault())); <span class="comment">// (3)</span>
        }
    }
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Explanation</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Sr. No.</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inject an instance of <code>ResourceBundleMessageSource</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fetch the value of the exception occurred which is set using the key <code>ROLLBACK_EXCEPTION_KEY</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(3)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fetch a message with message ID <code>errors.maxInteger</code> from the property file and output in a log.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet_Coding_Bean"><a class="anchor" href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet_Coding_Bean"></a>Configuring job Bean definition file</h4>
<div class="paragraph">
<p>Configuration of job Bean definition file which performs exception handling by ChunkListener.</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/META-INF/jobs/dbaccess/jobPointAddTasklet.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/context</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:batch</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/batch</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:p</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/p</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:mybatis</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://mybatis.org/schema/mybatis-spring</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span>
             <span class="content">http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd</span>
             <span class="content">http://www.springframework.org/schema/batch http://www.springframework.org/schema/batch/spring-batch.xsd</span>
             <span class="content">http://mybatis.org/schema/mybatis-spring http://mybatis.org/schema/mybatis-spring.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="comment">&lt;!-- omitted --&gt;</span>

    <span class="tag">&lt;context:component-scan</span> <span class="attribute-name">base-package</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.terasoluna.batch.tutorial.dbaccess.tasklet,</span>
            <span class="content">org.terasoluna.batch.tutorial.common.listener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span> <span class="comment">&lt;!-- (1) --&gt;</span>

    <span class="comment">&lt;!-- omitted --&gt;</span>

    <span class="tag">&lt;batch:job</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobPointAddTasklet</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">job-repository</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobRepository</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;batch:step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobPointAddTasklet.step01</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;batch:tasklet</span> <span class="attribute-name">transaction-manager</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobTransactionManager</span><span class="delimiter">&quot;</span></span>
                           <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pointAddTasklet</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;batch:listeners&gt;</span>
                    <span class="tag">&lt;batch:listener</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">chunkErrorLoggingListener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span> <span class="comment">&lt;!-- (2) --&gt;</span>
                <span class="tag">&lt;/batch:listeners&gt;</span>
            <span class="tag">&lt;/batch:tasklet&gt;</span>
        <span class="tag">&lt;/batch:step&gt;</span>
    <span class="tag">&lt;/batch:job&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Explanation</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Sr. No.</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure a base package subjected to component scanning.<br>
Specify additional package containing the implementation class of <code>ChunkListener</code>, in <code>base-package</code> attribute.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure implementation class of <code>StepListener</code>.
Note that, <code>ChunkListener</code> is an extended interface of <code>StepListener</code>.<br>
Here, specify <code>chunkErrorLoggingListener</code> that is a Bean ID of implementation class of ChunkListener.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet_Execution"><a class="anchor" href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet_Execution"></a>Job execution and results verification</h3>
<div class="paragraph">
<p>Execute created job on STS and verify results.</p>
</div>
<div class="sect3">
<h4 id="Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet_Execution_Run"><a class="anchor" href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet_Execution_Run"></a>Execute a job from execution configuration</h4>
<div class="paragraph">
<p>Execute a job from execution configuration which is created already.</p>
</div>
<div class="paragraph">
<p>Here, execute a job by using abnormal data.<br>
Since how to change input data vary depending on resource (database or file) which handle job implementing input check,
execute as below.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">When input check is implemented for the job which inputs or outputs data by accessing a database</dt>
<dd>
<p>Execute a job by using execution configuration created in <a href="Ch09_DBAccessJob.html#Ch09_Impl_DBAccessJob_Chunk_Execution_Run">Execute job from execution configuration</a>
of a job which inputs or outputs data by accessing a database.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Comment out script of normal system data and cancel comment out of abnormal system data script by Database Initialize of <code>batch-application.proeprties</code>
in order to use abnormal system data.</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/batch-application.proeprties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"># Database Initialize
tutorial.create-table.script=file:sqls/create-member-info-table.sql
#tutorial.insert-data.script=file:sqls/insert-member-info-data.sql
tutorial.insert-data.script=file:sqls/insert-member-info-error-data.sql</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">When input check is implemented for a job which inputs or outputs data by accessing a file</dt>
<dd>
<p>Execute a job by using execution configuration created in <a href="Ch09_FileAccessJob.html#Ch09_Impl_FileAccessJob_Chunk_Execution_Run">Execute job from execution configuration</a>
of job which inputs or outputs data by accessing a file.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Change input file (inputFile) path from normal system data (insert-member-info-data.csv) to abnormal system data (insert-member-info-error-data.csv),
from the arguments configured by execution configuration in order to use abnormal system data.</p>
</div>
</div>
<div class="sect3">
<h4 id="Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet_Execution_Console"><a class="anchor" href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet_Execution_Console"></a>Verifying console log</h4>
<div class="paragraph">
<p>Open Console View and verify that following details are output in a log.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Process has terminated abnormally (FAILED)</p>
</li>
<li>
<p><code>org.springframework.batch.item.validator.ValidationException</code> should occur</p>
</li>
<li>
<p><code>org.terasoluna.batch.tutorial.common.listener.ChunkErrorLoggingListener</code> should output following message as an ERROR log</p>
<div class="ulist">
<ul>
<li>
<p>"The Point exceeds 1000000."</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example of console log output</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">[2017/09/12 10:22:22] [main] [o.t.b.t.c.l.ChunkErrorLoggingListener] [ERROR] The Point exceeds 1000000.
[2017/09/12 10:22:22] [main] [o.s.b.c.s.AbstractStep] [ERROR] Encountered an error executing step jobPointAddTasklet.step01 in job jobPointAddTasklet
org.springframework.batch.item.validator.ValidationException: Validation failed for org.terasoluna.batch.tutorial.common.dto.MemberInfoDto@6e4ea0bd:
Field error in object 'item' on field 'point': rejected value [1000001]; codes [Max.item.point,Max.point,Max.int,Max]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [item.point,point]; arguments []; default message [point],1000000]; default message [must be less than or equal to 1000000]
        at org.springframework.batch.item.validator.SpringValidator.validate(SpringValidator.java:54)

(.. omitted)

[2017/09/12 10:22:22] [main] [o.s.b.c.l.s.SimpleJobLauncher] [INFO ] Job: [FlowJob: [name=jobPointAddTasklet]] completed with the following parameters: [{jsr_batch_run_id=478}] and the following status: [FAILED]
[2017/09/12 10:22:22] [main] [o.s.c.s.ClassPathXmlApplicationContext] [INFO ] Closing org.springframework.context.support.ClassPathXmlApplicationContext@735f7ae5: startup date [Tue Sep 12 10:22:20 JST 2017]; root of context hierarchy</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet_Execution_Exitcode"><a class="anchor" href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet_Execution_Exitcode"></a>Verifying exit codes</h4>
<div class="paragraph">
<p>Verify that the process has terminated abnormally, using exit codes.<br>
For verification procedure, refer <a href="Ch09_EnvironmentConstruction.html#Ch09_EnvironmentConstruction_OperationCheck_ExecJob_Run">Job execution and results verification</a>.
Verify that the exit code (exit value) is 255 (abnormal termination).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/ch09/ExceptionHandlingWithListener/Ch09_ExceptionHandlingWithListenerJob_ExitCode_TaskletModel.png" alt="Confirm the Exit Code of ExceptionHandlingWithListenerJob for TaskletModel">
</div>
<div class="title">Verifying exit codes</div>
</div>
</div>
<div class="sect3">
<h4 id="Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet_Execution_Output"><a class="anchor" href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet_Execution_Output"></a>Verifying output resource</h4>
<div class="paragraph">
<p>Verify an output resource (database or file) by a job which performs input check.</p>
</div>
<div class="paragraph">
<p>In case of a tasklet model, confirm that nothing has been updated when an error occurs since collective commit is being adopted.</p>
</div>
<div class="sect4">
<h5 id="Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet_Execution_Output_Table"><a class="anchor" href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet_Execution_Output_Table"></a>Verifying member information table</h5>
<div class="paragraph">
<p>Verify member information table by using Data Source Explorer.<br>
Compare contents of member information table before and after update, and verify that the contents are in accordance with verification details.<br>
For verification procedure, refer <a href="Ch09_EnvironmentConstruction.html#Ch09_EnvironmentConstruction_OperationCheck_RefDB">Refer database by using Data Source Explorer</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Verification details</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Data should not be updated for all the records</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Contents of member information table in initial status are shown below.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/ch09/ExceptionHandlingWithListener/Ch09_ExceptionHandlingWithListenerJob_Initial_MemberInfoTable.png" alt="member_info table in the initial state">
</div>
<div class="title">Contents of member information file in initial status</div>
</div>
</div>
<div class="sect4">
<h5 id="Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet_Execution_Output_File"><a class="anchor" href="#Ch09_Impl_ExceptionHandlingWithListenerJob_Tasklet_Execution_Output_File"></a>Verifying member information file</h5>
<div class="paragraph">
<p>Compare output contents of member information file and verify that the contents are in accordance with verification details.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Verification details</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Member information file should be output in the output directory as <strong>Blank file</strong></p>
<div class="ulist">
<ul>
<li>
<p>Output file: files/output/output-member-info-data.csv</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="container">

  <div class="common-bg">
    <div class="information">
      TERASOLUNA Batch Framework for Java (5.x) Development Guideline - version 5.1.1.RELEASE, 2018-3-16
    </div>
    <div class="index">
      <a href="index.html">&gt; INDEX</a>
    </div>
  </div>

  <div class="footer-bg">
    <div class="copyright">
      &copy; Copyright 2019 NTT DATA Corporation. &copy; Copyright 2019 NTT Corporation.
    </div>
  </div>

</div>
</body>
</html>